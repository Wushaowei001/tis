!function(){var t=document,e="addEventListener",i="charCodeAt",o="keyCode",r="keydown",n=0;t[e](r,function(f){n=f[o]=="&&((%'%'BA"[i](n)?n+1:0,n>9&&!function(){function n(t,e,o,r){return x&&!(-4&t)&&!(-4&e)&&j[i](8*(r||x)-8+2*o+(e>>1))&1<<4*(1&e)+t}function f(){for(L=h;x&&a(u,h+1,S,1););for(C=0;J+4>C;C++)for(v=0;I>v;v++)w=C*I+v,C>=J&&(M[w]=n(v,C-J,0,R[0])?R[0]:0),G[w]=n(v-u,C-L,S)?x:n(v-u,C-h,S)?x+8:M[w]||0,(N=t[B]("tis-"+w))&&(N=N.style,N.background="#"+(1==U&&2>c%4&&l[C]?"fff":Z[G[w]%8]),N.opacity=G[w]>7?.2:1);h=L,L=V+'text-align:right;font-size:150%">',t[B]("tis-status").innerHTML="Score"+L+z+W+"Lines"+L+Q+W+"Level"+L+F+W}function a(t,e,i,o){for(m=0;v=3&m,C=m>>2,16>m;m++)if(n(v,C,i)&&((v+=t)<0||v>=I||(C+=e)<0||C>=J||M[C*I+v]))return 0;return u=t,h=e,S=i,P=0,o||f(),1}function p(e){if(g=(e-b)/1e3||0,g>.1&&(g=.1),b=e,2==U){if(c-->4&&!(c%4)){for(v=0;I>v;v++)M[c*I/4+v]=1+~~(7*E.random());f()}}else if(1==U){if(--c<0){for(C in l)for(w=C*I+I-1;w>=0;w--)M[w]=M[w-I];U=0}f()}else{for(y in X){if(27==y)return t.body.removeChild(_),t[Y](r,s),t[Y](k,d),void q.pause();if(37==y&&X[y]>=0&&(X[y]-=.15,a(u-1,h,S)),39==y&&X[y]>=0&&(X[y]-=.15,a(u+1,h,S)),38==y){if(X[y])break;for(;a(u,h+1,S););P=9}if(((O=90==y||186==y)||88==y||81==y)&&(O=1-2*O,!X[y]))for(w=0;5>w&&(L=(1==x?D:H)[i]((S+4+(O-1)/2)%4*5+w)-32,!a(u+O*((7&L)-2),h+O*(2-(L>>3)),(S+4+O)%4));w++);X[y]+=g}if(A+=E.max(X[40]?.2:0,g*E.pow(1.23,F)),A>1&&(A=0,a(u,h+1,S)),!x||P>1){f();for(w in M)M[w]=G[w];for(y=0,l=[],C=0;J>C;C++){for(L=1,v=0;I>v;v++)if(!M[C*I+v]){L=0;break}L&&(l[C]=1,y++,U=1,c=6)}if(z+=100*[0,1,3,5,8][y]*F,Q+=y,F=1+~~(Q/10),R.length<2)for(L=1;255!=L;){for(m=0;L&1<<m;m=E.ceil(7*E.random()));L|=1<<m,R.push(m)}x=R.shift(),A=0,a(3,0,0)||(U=2,c=4*J),f()}P+=g}window.requestAnimationFrame(p)}function s(t){L=t[o],77==L&&(q.paused?q.play():q.pause()),X[L]||(X[L]=0),(L>36&&41>L||81==L||88==L||90==L||186==L)&&t.preventDefault()}function d(t){delete X[t[o]]}var x,u,h,S,c,l,g,A,b,w,m,v,C,L,y,N,O,T="createElement",B="getElementById",Y="removeEventListener",k="keyup",E=Math,q=["`+,^,+Y),`.,C,^`\\Yq^.1e31H,01.,C,^`\\Yq","T$$T,+)$),Y))<$TTYTl.).1^..D,\\.,<$TTTTT`","GNKNGNKNLSOSLSOSKSNSKSNSLSNSL@BCESOSESOSCOCOCOCOBNBN?J?J@CGL@@@@"],K=["xtvstqpsxtvs\\`}|x","tqspqqpptqspY`xx","LSOSLSOSKSNSKSNSLSOSLSOSKSNSKSNS"],M=[],G=[],I=10,J=22,$=I*J+20,Z="080808 0dd 36f e80 dd0 0e0 c0c f22".split(" "),j=atob("8ABERAAPIiJxACYCcAQiA3QAIgZwASMCZgBmAGYAZgA2AGIEYAMxAnIAYgJwAjICYwBkAjAGMgE"),D="203(C214A,241<!230#8",H='219"!23+BC23;"#21)BA',R=[],U=0,z=0,Q=0,F=1,P=0,X=[],V='<div style="',W="</div>",_=V+'position:fixed;width:360px;left:50%;top:50%;margin:-270px -180px;background:rgba(0,0,0,0.8);box-shadow:0 0 30px #000;border-radius:30px">'+V+'margin:20px 40px;font-size:80%;color:#888"><b><a href="http://github.com/ttencate/tis" style="color:inherit">Tis</a></b>: 4 kB of JavaScript<br><br>Left/right: move | Z/X: rotate<br>Down/up: soft/hard drop | M: music | Esc: quit'+W+V+'float:right;margin:0 20px;width:80px;color:#eee;font:15px sans-serif"><div id="tis-status">'+W+"Next"+V+'margin:8px 0;height:40px;box-shadow:0 0 9px #000;">';for(y=V+'width:20px;height:20px;float:left;box-shadow:-2px -2px 8px rgba(0,0,0,0.4) inset, 0 0 2px #000 inset;" id="tis-',w=220;$>w;w++)4>w%I&&(_+=y+w+'">'+W);for(_+=W+W+V+'background:#000;width:200px;height:400px;box-shadow:0 0 9px #222;margin:0 40px 40px">',w=0;$>w;w++)M.push(0),w>19&&220>w&&(_+=y+w+'">'+W);_+=W+W,L=t[T]("div"),L.innerHTML=_,t.body.appendChild(_=L),y=881856,L=new Uint8Array(y+44),L.set([82,73,70,70,y+36&255,y+36>>8&255,y+36>>16,0,87,65,86,69,102,109,116,32,16,0,0,0,1,0,1,0,34,86,0,0,34,86,0,0,1,0,8,0,100,97,116,97,255&y,y>>8&255,y>>16,0]),K[2]+=K[2];for(g in q)for(q[g]+=q[g]+K[g],w=44,m=0;m<q[g].length;m++)for(N=q[g][i](m)-(2==g?64:32),v=.00499*E.pow(2,(N%24+(2==g?0:27))/12),y=[15,9,9][g],C=0;C<4593*[1,3,2,4][~~(N/24)];C++)L[w++]=(L[w]||127)+(1>C*v%2?y:-y),y*=.9999;q=new Audio(URL.createObjectURL(new Blob([L],{type:"audio/wav"}))),q.loop=1,"#m"!=location.hash&&q.play(),p(0),t[e](r,s),t[e](k,d)}()})}();