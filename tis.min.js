document.addEventListener("DOMContentLoaded",function(){function e(e,t,i,o){return r&&!(-4&e)&&!(-4&t)&&Y.charCodeAt(8*(o||r)-8+2*i+(t>>1))&1<<4*(1&t)+e}function t(){for(b=n;r&&i(a,n+1,d,1););for(v=0;O+4>v;v++)for(S=0;N>S;S++)x=v*N+S,v>=O&&(k[x]=e(S,v-O,0,U[0])?U[0]:0),M[x]=e(S-a,v-b,d)?r:e(S-a,v-n,d)?r+8:k[x]||0,(g=w[C]("tis-"+x))&&(g=g.style,g.background="#"+(1==K&&2>s%4&&f[v]?"fff":B[M[x]%8]),g.opacity=M[x]>7?.2:1);n=b,b='<div style="text-align:right;font-size:150%">',w[C]("tis-status").innerHTML="Score"+b+G+"</div>Lines"+b+J+"</div>Level"+b+$+"</div>"}function i(i,o,r,s){for(l=0;S=3&l,v=l>>2,16>l;l++)if(e(S,v,r)&&((S+=i)<0||S>=N||(v+=o)<0||v>=O||k[v*N+S]))return 0;return a=i,n=o,d=r,D=0,s||t(),1}function o(e){switch(c=(e-h)/1e3||0,c>.1&&(c=.1),h=e,K){case 2:if(s-->4&&!(s%4)){for(S=0;N>S;S++)k[s*N/4+S]=1+Math.floor(7*Math.random());t()}break;case 1:if(--s<0){for(v in f)for(x=v*N+N-1;x>=0;x--)k[x]=k[x-N];K=0}t();break;case 0:A=1;for(u in Z){switch(parseInt(u)){case 37:if(Z[u]<0)break;Z[u]-=I,i(a-1,n,d);break;case 39:if(Z[u]<0)break;Z[u]-=I,i(a+1,n,d);break;case 38:if(Z[u])break;for(;i(a,n+1,d););D=9;break;case 90:case 186:A=-1;case 88:case 81:if(!Z[u])for(x=0;5>x&&(b=(1==r?E:q).charCodeAt((d+4+(A-1)/2)%4*5+x)-32,!i(a+A*((7&b)-2),n+A*(2-(b>>3)),(d+4+A)%4));x++);}Z[u]+=c}if(p+=Math.max(Z[40]?.2:0,c*($+1)/1.5),p>1&&(p=0,i(a,n+1,d)),!r||D>1){t();for(x in k)k[x]=M[x];for(u=0,f=[],v=0;O>v;v++){for(b=1,S=0;N>S;S++)if(!k[v*N+S]){b=0;break}b&&(f[v]=1,u++,K=1,s=6)}if(G+=[0,100,300,500,800][u]*$,J+=u,$=1+Math.floor(J/10),U.length<2)for(b=1;255!=b;){for(l=0;b&1<<l;l=Math.ceil(7*Math.random()));b|=1<<l,U.push(l)}r=U.shift(),p=0,i(3,0,0)||(K=2,s=4*O),t()}D+=c}window.requestAnimationFrame(o)}var r,a,n,d,s,f,p,c,h,x,l,S,v,b,u,g,A,w=document,C="getElementById",m="addEventListener",y=["`+,^,+Y),`.,C,^`\\Yq^.1e31H,01.,C,^`\\Yq","T$$T,+)$),Y))<$TTYTl.).1^..D,\\.,<$TTTTT`","GNKNGNKNLSOSLSOSKSNSKSNSLSNSL@BCESOSESOSCOCOCOCOBNBN?J?J@CGL@@@@"],L=["xtvstqpsxtvs\\`}|x","tqspqqpptqspY`xx","LSOSLSOSKSNSKSNSLSOSLSOSKSNSKSNS"],k=[],M=[],N=10,O=22,T=N*O+20,B="080808 0dd 36f e80 dd0 0e0 c0c f22".split(" "),Y=atob("8ABERAAPIiJxACYCcAQiA3QAIgZwASMCZgBmAGYAZgA2AGIEYAMxAnIAYgJwAjICYwBkAjAGMgE"),E="203(C214A,241<!230#8",q='219"!23+BC23;"#21)BA',I=.15,K=0,G=0,J=0,$=1,D=0,U=[],Z=[],j='<div style="position:fixed;width:360px;left:50%;top:50%;margin:-270px -180px;background:rgba(0,0,0,0.8);box-shadow:0 0 30px #000;border-radius:30px"><div style="margin:20px 40px;font-size:80%;color:#888"><b><a href="http://github.com/ttencate/tis" style="color:inherit">Tis</a></b>: 4 kB of JavaScript<br><br>Left/right: move | Z/X: rotate<br>Down: soft drop | Up: hard drop | M: music</div><div style="float:right;margin:0 20px;width:80px;color:#eee;font:15px sans-serif"><div id="tis-status"></div>Next<div style="margin:8px 0;height:40px;box-shadow:0 0 9px #000;">';for(u='" style="width:20px;height:20px;float:left;box-shadow:-2px -2px 8px rgba(0,0,0,0.4) inset, 0 0 2px #000 inset;"></div>',x=220;T>x;x++)4>x%N&&(j+='<div id="tis-'+x+u);for(j+='</div></div><div style="background:#000;width:200px;height:400px;box-shadow:0 0 9px #222;margin:0 40px 40px">',x=0;T>x;x++)k.push(0),x>19&&220>x&&(j+='<div id="tis-'+x+u);j+="</div></div>",b=w.createElement("div"),b.innerHTML=j,w.body.appendChild(b),u=881856,b=new Uint8Array(u+44),b.set([82,73,70,70,u+36&255,u+36>>8&255,u+36>>16,0,87,65,86,69,102,109,116,32,16,0,0,0,1,0,1,0,34,86,0,0,34,86,0,0,1,0,8,0,100,97,116,97,255&u,u>>8&255,u>>16,0]),L[2]+=L[2];for(c in y)for(y[c]+=y[c]+L[c],x=44,l=0;l<y[c].length;l++)for(g=y[c].charCodeAt(l)-(2==c?64:32),S=2*Math.PI*(2==c?55:261.63)*Math.pow(2,g%24/12)/22050,u=[.2,.1,.1][c],v=0;v<4593*[1,3,2,4][Math.floor(g/24)];v++)b[x++]+=127*((0==c)+u*(Math.sin(v*S)>0?1:-1)),u*=.9999;y=w.createElement("audio"),y.src=URL.createObjectURL(new Blob([b],{type:"audio/wav"})),y.loop=1,"#m"!=location.hash&&y.play(),o(0),w[m]("keydown",function(e){b=e.keyCode,77==b&&(y.paused?y.play():y.pause()),Z[b]||(Z[b]=0),(b>36&&41>b||88==b||88==b||90==b||186==b)&&e.preventDefault()}),w[m]("keyup",function(e){delete Z[e.keyCode]})});