!function(){var i=document,e="addEventListener",t="charCodeAt",o="keyCode",r="&&((%'%'BA",n=0;i[e]("keydown",function(d){n=d[o]==r[t](n)?n+1:0,n>9&&!function(){function r(i,e,o,r){return p&&!(-4&i)&&!(-4&e)&&$[t](8*(r||p)-8+2*o+(e>>1))&1<<4*(1&e)+i}function n(){for(m=l;p&&d(x,l+1,u,1););for(y=0;G+4>y;y++)for(w=0;M>w;w++)A=y*M+w,y>=G&&(q[A]=r(w,y-G,0,D[0])?D[0]:0),K[A]=r(w-x,y-m,u)?p:r(w-x,y-l,u)?p+8:q[A]||0,(L=i[O]("tis-"+A))&&(L=L.style,L.background="#"+(1==H&&2>v%4&&h[y]?"fff":J[K[A]%8]),L.opacity=K[A]>7?.2:1);l=m,m='<div style="text-align:right;font-size:150%">',i[O]("tis-status").innerHTML="Score"+m+R+"</div>Lines"+m+U+"</div>Level"+m+z+"</div>"}function d(i,e,t,o){for(b=0;w=3&b,y=b>>2,16>b;b++)if(r(w,y,t)&&((w+=i)<0||w>=M||(y+=e)<0||y>=G||q[y*M+w]))return 0;return x=i,l=e,u=t,Q=0,o||n(),1}function f(e){if(S=(e-g)/1e3||0,S>.1&&(S=.1),g=e,2==H){if(v-->4&&!(v%4)){for(w=0;M>w;w++)q[v*M/4+w]=1+~~(7*B.random());n()}}else if(1==H){if(--v<0){for(y in h)for(A=y*M+M-1;A>=0;A--)q[A]=q[A-M];H=0}n()}else{for(C in F){if(27==C)return i.body.removeChild(P),i[T]("keydown",a),i[T]("keyup",s),void Y.pause();if(37==C&&F[C]>=0&&(F[C]-=.15,d(x-1,l,u)),39==C&&F[C]>=0&&(F[C]-=.15,d(x+1,l,u)),38==C){if(F[C])break;for(;d(x,l+1,u););Q=9}if((90==C||186==C||88==C||81==C)&&(N=90==C||186==C?-1:1,!F[C]))for(A=0;5>A&&(m=(1==p?Z:j)[t]((u+4+(N-1)/2)%4*5+A)-32,!d(x+N*((7&m)-2),l+N*(2-(m>>3)),(u+4+N)%4));A++);F[C]+=S}if(c+=B.max(F[40]?.2:0,S*B.pow(1.23,z)),c>1&&(c=0,d(x,l+1,u)),!p||Q>1){n();for(A in q)q[A]=K[A];for(C=0,h=[],y=0;G>y;y++){for(m=1,w=0;M>w;w++)if(!q[y*M+w]){m=0;break}m&&(h[y]=1,C++,H=1,v=6)}if(R+=[0,100,300,500,800][C]*z,U+=C,z=1+~~(U/10),D.length<2)for(m=1;255!=m;){for(b=0;m&1<<b;b=B.ceil(7*B.random()));m|=1<<b,D.push(b)}p=D.shift(),c=0,d(3,0,0)||(H=2,v=4*G),n()}Q+=S}window.requestAnimationFrame(f)}function a(i){m=i[o],77==m&&(Y.paused?Y.play():Y.pause()),F[m]||(F[m]=0),(m>36&&41>m||81==m||88==m||90==m||186==m)&&i.preventDefault()}function s(i){delete F[i[o]]}var p,x,l,u,v,h,S,c,g,A,b,w,y,m,C,L,N,k="createElement",O="getElementById",T="removeEventListener",B=Math,Y=["`+,^,+Y),`.,C,^`\\Yq^.1e31H,01.,C,^`\\Yq","T$$T,+)$),Y))<$TTYTl.).1^..D,\\.,<$TTTTT`","GNKNGNKNLSOSLSOSKSNSKSNSLSNSL@BCESOSESOSCOCOCOCOBNBN?J?J@CGL@@@@"],E=["xtvstqpsxtvs\\`}|x","tqspqqpptqspY`xx","LSOSLSOSKSNSKSNSLSOSLSOSKSNSKSNS"],q=[],K=[],M=10,G=22,I=M*G+20,J="080808 0dd 36f e80 dd0 0e0 c0c f22".split(" "),$=atob("8ABERAAPIiJxACYCcAQiA3QAIgZwASMCZgBmAGYAZgA2AGIEYAMxAnIAYgJwAjICYwBkAjAGMgE"),Z="203(C214A,241<!230#8",j='219"!23+BC23;"#21)BA',D=[],H=0,R=0,U=0,z=1,Q=0,F=[],P='<div style="position:fixed;width:360px;left:50%;top:50%;margin:-270px -180px;background:rgba(0,0,0,0.8);box-shadow:0 0 30px #000;border-radius:30px"><div style="margin:20px 40px;font-size:80%;color:#888"><b><a href="http://github.com/ttencate/tis" style="color:inherit">Tis</a></b>: 4 kB of JavaScript<br><br>Left/right: move | Z/X: rotate<br>Down/up: soft/hard drop | M: music | Esc: quit</div><div style="float:right;margin:0 20px;width:80px;color:#eee;font:15px sans-serif"><div id="tis-status"></div>Next<div style="margin:8px 0;height:40px;box-shadow:0 0 9px #000;">';for(C='" style="width:20px;height:20px;float:left;box-shadow:-2px -2px 8px rgba(0,0,0,0.4) inset, 0 0 2px #000 inset;"></div>',A=220;I>A;A++)4>A%M&&(P+='<div id="tis-'+A+C);for(P+='</div></div><div style="background:#000;width:200px;height:400px;box-shadow:0 0 9px #222;margin:0 40px 40px">',A=0;I>A;A++)q.push(0),A>19&&220>A&&(P+='<div id="tis-'+A+C);P+="</div></div>",m=i[k]("div"),m.innerHTML=P,i.body.appendChild(P=m),C=881856,m=new Uint8Array(C+44),m.set([82,73,70,70,C+36&255,C+36>>8&255,C+36>>16,0,87,65,86,69,102,109,116,32,16,0,0,0,1,0,1,0,34,86,0,0,34,86,0,0,1,0,8,0,100,97,116,97,255&C,C>>8&255,C>>16,0]),E[2]+=E[2];for(S in Y)for(Y[S]+=Y[S]+E[S],A=44,b=0;b<Y[S].length;b++)for(L=Y[S][t](b)-(2==S?64:32),w=.00499*B.pow(2,(L%24+(2==S?0:27))/12),C=[15,9,9][S],y=0;y<4593*[1,3,2,4][~~(L/24)];y++)m[A++]=(m[A]||127)+(1>y*w%2?C:-C),C*=.9999;Y=new Audio(URL.createObjectURL(new Blob([m],{type:"audio/wav"}))),Y.loop=1,"#m"!=location.hash&&Y.play(),f(0),i[e]("keydown",a),i[e]("keyup",s)}()})}();