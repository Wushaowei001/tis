!function(){var t=document,e="addEventListener",i="charCodeAt",o="keyCode",r="keydown",n=0;t[e](r,function(f){n=f[o]=="&&((%'%'BA"[i](n)?n+1:0,n>9&&!function(){function n(t,e,o,r){return x&&!(-4&t)&&!(-4&e)&&j[i](8*(r||x)-8+2*o+(e>>1))&1<<4*(1&e)+t}function f(){for(m=S;x&&p(u,S+1,c,1););for(L=0;J+4>L;L++)for(C=0;I>C;C++)v=L*I+C,L>=J&&(M[v]=n(C,L-J,0,R[0])?R[0]:0),G[v]=n(C-u,L-m,c)?x:n(C-u,L-S,c)?x+8:M[v]||0,(y=T["tis-"+v])&&(y=y.style,y.background="#"+(1==U&&2>h%4&&l[L]?"fff":Z[G[v]%8]),y.opacity=G[v]>7?.2:1);S=m,m=V+'0;text-align:right;font-size:150%">',T["tis-status"].innerHTML="Score"+m+z+W+"Lines"+m+Q+W+"Level"+m+F+W}function p(t,e,i,o){for(w=0;C=3&w,L=w>>2,16>w;w++)if(n(C,L,i)&&((C+=t)<0||C>=I||(L+=e)<0||L>=J||M[L*I+C]))return;return u=t,S=e,c=i,P=0,o||f(),1}function a(e){if(A=(e-b)/1e3||0,A>.1&&(A=.1),b=e,2==U){if(h-->4&&!(h%4)){for(C=0;I>C;C++)M[h*I/4+C]=1+~~(7*q.random());f()}}else if(1==U){if(--h<0){for(L in l)for(v=L*I+I-1;v>=0;v--)M[v]=M[v-I];U=0}f()}else{for(N in X){if(27==N)return t.body.removeChild(te),t[Y](r,s),t[Y](k,d),void E.pause();if(37==N&&X[N]>=0&&(X[N]-=.15,p(u-1,S,c)),39==N&&X[N]>=0&&(X[N]-=.15,p(u+1,S,c)),38==N){if(X[N])break;for(;p(u,S+1,c););P=9}if(((O=90==N||186==N)||88==N||81==N)&&(O=1-2*O,!X[N]))for(v=0;5>v&&(m=(1==x?D:H)[i]((c+4+(O-1)/2)%4*5+v)-32,!p(u+O*((7&m)-2),S+O*(2-(m>>3)),(c+4+O)%4));v++);X[N]+=A}if(g+=q.max(X[40]?.2:0,A*q.pow(1.23,F)),g>1&&(g=0,p(u,S+1,c)),!x||P>1){for(v in M)M[v]=G[v];for(N=0,l=[],L=0;J>L;L++){for(m=1,C=0;I>C;C++)if(!M[L*I+C]){m=0;break}m&&(l[L]=1,N++,U=1,h=6)}if(z+=100*[0,1,3,5,8][N]*F,Q+=N,F=1+~~(Q/10),R.length<2)for(m=1;255!=m;){for(w=0;m&1<<w;w=q.ceil(7*q.random()));m|=1<<w,R.push(w)}x=R.shift(),g=0,p(3,0,0)||(x=0,U=2,h=4*J)}P+=A}requestAnimationFrame(a)}function s(t){m=t[o],77==m&&(E.paused?E.play():E.pause()),X[m]||(X[m]=0),(m>36&&41>m||81==m||88==m||90==m||186==m)&&t.preventDefault()}function d(t){delete X[t[o]]}var x,u,S,c,h,l,A,g,b,v,w,C,L,m,N,y,O,T=window,B="createElement",Y="removeEventListener",k="keyup",q=Math,E=["`+,^,+Y),`.,C,^`\\Yq^.1e31H,01.,C,^`\\Yq","T$$T,+)$),Y))<$TTYTl.).1^..D,\\.,<$TTTTT`","GNKNGNKNLSOSLSOSKSNSKSNSLSNSL@BCESOSESOSCOCOCOCOBNBN?J?J@CGL@@@@"],K=["xtvstqpsxtvs\\`}|x","tqspqqpptqspY`xx","LSOSLSOSKSNSKSNSLSOSLSOSKSNSKSNS"],M=[],G=[],I=10,J=22,$=I*J+20,Z="080808 0dd 36f e80 dd0 0e0 c0c f22".split(" "),j=atob("8ABERAAPIiJxACYCcAQiA3QAIgZwASMCZgBmAGYAZgA2AGIEYAMxAnIAYgJwAjICYwBkAjAGMgE"),D="203(C214A,241<!230#8",H='219"!23+BC23;"#21)BA',R=[],U=0,z=0,Q=0,F=1,P=0,X=[],V='<div style="margin:',W="</div>",_=";box-shadow:",te=V+"-270px -180px;position:fixed;width:360px;left:50%;top:50%;font:13px sans-serif;background:rgba(0,0,0,.8)"+_+'0 0 30px #000;border-radius:30px">'+V+'20px 40px;color:#888"><b><a href="http://github.com/ttencate/tis" style="color:inherit">Tis</a></b>: 4 kB of JavaScript<br><br>Left/right: move | Z/X: rotate<br>Down/up: soft/hard drop | M: music | Esc: quit'+W+V+'0 20px;float:right;width:80px;color:#eee;font-size:15px"><div id="tis-status">'+W+"Next"+V+"8px 0;height:40px"+_+'0 0 9px #000">';for(N=V+"0;width:20px;height:20px;float:left"+_+'-2px -2px 8px rgba(0,0,0,.4) inset,0 0 2px #000 inset" id="tis-',v=220;$>v;v++)4>v%I&&(te+=N+v+'">'+W);for(te+=W+W+V+"0 40px 40px;background:#000;width:200px;height:400px"+_+'0 0 9px #222">',v=0;$>v;v++)M.push(0),v>19&&220>v&&(te+=N+v+'">'+W);te+=W+W,m=t[B]("div"),m.innerHTML=te,t.body.appendChild(te=m),N=881856,m=new Uint8Array(N+44),m.set([82,73,70,70,N+36&255,N+36>>8&255,N+36>>16,0,87,65,86,69,102,109,116,32,16,0,0,0,1,0,1,0,34,86,0,0,34,86,0,0,1,0,8,0,100,97,116,97,255&N,N>>8&255,N>>16,0]),K[2]+=K[2];for(A in E)for(E[A]+=E[A]+K[A],v=44,w=0;w<E[A].length;w++)for(y=E[A][i](w)-(2==A?64:32),C=.00499*q.pow(2,(y%24+(2==A?0:27))/12),N=[15,9,9][A],L=0;L<4593*[1,3,2,4][~~(y/24)];L++)m[v++]=(m[v]||127)+(1>L*C%2?N:-N),N*=.9999;E=new Audio(URL.createObjectURL(new Blob([m],{type:"audio/wav"}))),E.loop=1,"#m"!=location.hash&&E.play(),a(0),t[e](r,s),t[e](k,d)}()})}();