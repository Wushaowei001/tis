document.addEventListener("DOMContentLoaded",function(){function t(t,e,i,o){return a&&!(-4&t)&&!(-4&e)&&B.charCodeAt(8*(o||a)-8+2*i+(e>>1))&1<<4*(1&e)+t}function e(){for(v=d;a&&i(r,d+1,n,1););for(S=0;O+4>S;S++)for(u=0;N>u;u++)x=S*N+u,S>=O&&(m[x]=t(u,S-O,0,D[0])?D[0]:0),M[x]=t(u-r,S-v,n)?a:t(u-r,S-d,n)?a+8:m[x]||0,(b=C[w]("tis-"+x))&&(b=b.style,b.background="#"+(1==K&&2>s%4&&f[S]?"fff":Y[M[x]%8]),b.opacity=M[x]>7?.2:1);d=v,v='<div style="text-align:right;font-size:150%">',C[w]("tis-status").innerHTML="Score"+v+G+"</div>Lines"+v+$+"</div>Level"+v+J+"</div>"}function i(i,o,a,s){for(l=0;u=3&l,S=l>>2,16>l;l++)if(t(u,S,a)&&((u+=i)<0||u>=N||(S+=o)<0||S>=O||m[S*N+u]))return 0;return r=i,d=o,n=a,j=0,s||e(),1}function o(t){switch(c=(t-h)/1e3||0,c>.1&&(c=.1),h=t,K){case 2:if(s-->4&&!(s%4)){for(u=0;N>u;u++)m[s*N/4+u]=1+Math.floor(7*Math.random());e()}break;case 1:if(--s<0){for(S in f)for(x=S*N+N-1;x>=0;x--)m[x]=m[x-N];K=0}e();break;case 0:g=1;for(A in H){switch(parseInt(A)){case 37:if(H[A]<0)break;H[A]-=I,i(r-1,d,n);break;case 39:if(H[A]<0)break;H[A]-=I,i(r+1,d,n);break;case 38:if(H[A])break;for(;i(r,d+1,n););j=9;break;case 90:case 186:g=-1;case 88:case 81:if(!H[A])for(x=0;5>x&&(v=(1==a?E:q).charCodeAt((n+4+(g-1)/2)%4*5+x)-32,!i(r+g*((7&v)-2),d+g*(2-(v>>3)),(n+4+g)%4));x++);}H[A]+=c}if(p+=Math.max(H[40]?.2:0,c*(J+1)/1.5),p>1&&(p=0,i(r,d+1,n)),!a||j>1){e();for(x in m)m[x]=M[x];for(A=0,f=[],S=0;O>S;S++){for(v=1,u=0;N>u;u++)if(!m[S*N+u]){v=0;break}v&&(f[S]=1,A++,K=1,s=6)}if(G+=[0,100,300,500,800][A]*J,$+=A,J=1+Math.floor($/10),D.length<2)for(v=1;255!=v;){for(l=0;v&1<<l;l=Math.ceil(7*Math.random()));v|=1<<l,D.push(l)}a=D.shift(),p=0,i(3,0,0)||(K=2,s=4*O),e()}j+=c}window.requestAnimationFrame(o)}var a,r,d,n,s,f,p,c,h,x,l,u,S,v,A,b,g,C=document,w="getElementById",y="addEventListener",L=["`+,^,+Y),`.,C,^`\\Yq^.1e31H,01.,C,^`\\Yq","T$$T,+)$),Y))<$TTYTl.).1^..D,\\.,<$TTTTT`","GNKNGNKNLSOSLSOSKSNSKSNSLSNSL@BCESOSESOSCOCOCOCOBNBN?J?J@CGL@@@@"],k=["xtvstqpsxtvs\\`}|x","tqspqqpptqspY`xx","LSOSLSOSKSNSKSNSLSOSLSOSKSNSKSNS"],m=[],M=[],N=10,O=22,T=N*O+20,Y="080808 0dd 36f e80 dd0 0e0 c0c f22".split(" "),B=atob("8ABERAAPIiJxACYCcAQiA3QAIgZwASMCZgBmAGYAZgA2AGIEYAMxAnIAYgJwAjICYwBkAjAGMgE"),E="203(C214A,241<!230#8",q='219"!23+BC23;"#21)BA',I=.15,K=0,G=0,$=0,J=1,j=0,D=[],H=[],R='<div id="tis-root" style="position:fixed;width:280px;height:400px;left:50%;top:50%;margin:-240px -160px;background:rgba(0,0,0,0.8);box-shadow:0 0 30px #000;border-radius:30px;padding:40px"><div id="tis-grid" style="background:#000;width:200px;height:400px;box-shadow:0 0 9px #222;">';for(A='" style="width:20px;height:20px;float:left;box-shadow:-2px -2px 8px rgba(0,0,0,0.4) inset, 0 0 2px #000 inset;"></div>',x=0;T>x;x++)m.push(0),x>19&&220>x&&(R+='<div id="tis-'+x+A);for(R+='</div><div style="position:absolute;right:20px;top:40px;width:80px;color:#eee;font:normal 15px sans-serif"><div id="tis-status"></div>Next<div style="margin:8px 0;height:40px;box-shadow:0 0 9px #000;">',x=220;T>x;x++)4>x%N&&(R+='<div id="tis-'+x+A);R+="</div></div></div>",A=881856,v=new Uint8Array(A+44),v.set([82,73,70,70,A+36&255,A+36>>8&255,A+36>>16,0,87,65,86,69,102,109,116,32,16,0,0,0,1,0,1,0,34,86,0,0,34,86,0,0,1,0,8,0,100,97,116,97,255&A,A>>8&255,A>>16,0]),k[2]+=k[2];for(c in L)for(L[c]+=L[c]+k[c],x=44,l=0;l<L[c].length;l++)for(b=L[c].charCodeAt(l)-(2==c?64:32),u=2*Math.PI*(2==c?55:261.63)*Math.pow(2,b%24/12)/22050,A=[.2,.1,.1][c],S=0;S<4593*[1,3,2,4][Math.floor(b/24)];S++)v[x++]+=127*(!c+A*(Math.sin(S*u)>0?1:-1)),A*=.9999;R+='<audio id="tis-music" src="'+URL.createObjectURL(new Blob([v],{type:"audio/wav"}))+'" loop'+("#m"==location.hash?"":" autoplay")+"></audio>",v=C.createElement("div"),v.innerHTML=R,C.body.appendChild(v),o(0),C[y]("keydown",function(t){v=t.keyCode,77==v&&(v=C[w]("tis-music"),v.paused?v.play():v.pause()),H[v]||(H[v]=0),(v>36&&41>v||88==v||88==v||90==v||186==v)&&t.preventDefault()}),C[y]("keyup",function(t){delete H[t.keyCode]})});