!function(){function e(){function e(e,i,t,o){return c&&!(-4&e)&&!(-4&i)&&M[n](8*(o||c)-8+2*t+(i>>1))&1<<4*(1&i)+e}function d(){for(m=h;c&&f(x,h+1,l,1););for(k=0;E+4>k;k++)for(y=0;q>y;y++)A=k*q+y,k>=E&&(B[A]=e(y,k-E,0,$[0])?$[0]:0),Y[A]=e(y-x,k-m,l)?c:e(y-x,k-h,l)?c+8:B[A]||0,(L=i[r]("tis-"+A))&&(L=L.style,L.background="#"+(1==U&&2>S%4&&u[k]?"fff":I[Y[A]%8]),L.opacity=Y[A]>7?.2:1);h=m,m='<div style="text-align:right;font-size:150%">',i[r]("tis-status").innerHTML="Score"+m+Z+"</div>Lines"+m+j+"</div>Level"+m+D+"</div>"}function f(i,t,o,r){for(w=0;y=3&w,k=w>>2,16>w;w++)if(e(y,k,o)&&((y+=i)<0||y>=q||(k+=t)<0||k>=E||B[k*q+y]))return 0;return x=i,h=t,l=o,H=0,r||d(),1}function p(e){switch(v=(e-g)/1e3||0,v>.1&&(v=.1),g=e,U){case 2:if(S-->4&&!(S%4)){for(y=0;q>y;y++)B[S*q/4+y]=1+~~(7*a.random());d()}break;case 1:if(--S<0){for(k in u)for(A=k*q+q-1;A>=0;A--)B[A]=B[A-q];U=0}d();break;case 0:N=1;for(C in R){switch(parseInt(C)){case 37:if(R[C]<0)break;R[C]-=.15,f(x-1,h,l);break;case 39:if(R[C]<0)break;R[C]-=.15,f(x+1,h,l);break;case 38:if(R[C])break;for(;f(x,h+1,l););H=9;break;case 90:case 186:N=-1;case 88:case 81:if(!R[C])for(A=0;5>A&&(m=(1==c?G:J)[n]((l+4+(N-1)/2)%4*5+A)-32,!f(x+N*((7&m)-2),h+N*(2-(m>>3)),(l+4+N)%4));A++);}R[C]+=v}if(b+=a.max(R[40]?.2:0,v*a.pow(1.23,D)),b>1&&(b=0,f(x,h+1,l)),!c||H>1){d();for(A in B)B[A]=Y[A];for(C=0,u=[],k=0;E>k;k++){for(m=1,y=0;q>y;y++)if(!B[k*q+y]){m=0;break}m&&(u[k]=1,C++,U=1,S=6)}if(Z+=[0,100,300,500,800][C]*D,j+=C,D=1+~~(j/10),$.length<2)for(m=1;255!=m;){for(w=0;m&1<<w;w=a.ceil(7*a.random()));m|=1<<w,$.push(w)}c=$.shift(),b=0,f(3,0,0)||(U=2,S=4*E),d()}H+=v}window.requestAnimationFrame(p)}var c,x,h,l,S,u,v,b,g,A,w,y,k,m,C,L,N,O=["`+,^,+Y),`.,C,^`\\Yq^.1e31H,01.,C,^`\\Yq","T$$T,+)$),Y))<$TTYTl.).1^..D,\\.,<$TTTTT`","GNKNGNKNLSOSLSOSKSNSKSNSLSNSL@BCESOSESOSCOCOCOCOBNBN?J?J@CGL@@@@"],T=["xtvstqpsxtvs\\`}|x","tqspqqpptqspY`xx","LSOSLSOSKSNSKSNSLSOSLSOSKSNSKSNS"],B=[],Y=[],q=10,E=22,K=q*E+20,I="080808 0dd 36f e80 dd0 0e0 c0c f22".split(" "),M=atob("8ABERAAPIiJxACYCcAQiA3QAIgZwASMCZgBmAGYAZgA2AGIEYAMxAnIAYgJwAjICYwBkAjAGMgE"),G="203(C214A,241<!230#8",J='219"!23+BC23;"#21)BA',$=[],U=0,Z=0,j=0,D=1,H=0,R=[],z='<div style="position:fixed;width:360px;left:50%;top:50%;margin:-270px -180px;background:rgba(0,0,0,0.8);box-shadow:0 0 30px #000;border-radius:30px"><div style="margin:20px 40px;font-size:80%;color:#888"><b><a href="http://github.com/ttencate/tis" style="color:inherit">Tis</a></b>: 4 kB of JavaScript<br><br>Left/right: move | Z/X: rotate<br>Down: soft drop | Up: hard drop | M: music</div><div style="float:right;margin:0 20px;width:80px;color:#eee;font:15px sans-serif"><div id="tis-status"></div>Next<div style="margin:8px 0;height:40px;box-shadow:0 0 9px #000;">';for(C='" style="width:20px;height:20px;float:left;box-shadow:-2px -2px 8px rgba(0,0,0,0.4) inset, 0 0 2px #000 inset;"></div>',A=220;K>A;A++)4>A%q&&(z+='<div id="tis-'+A+C);for(z+='</div></div><div style="background:#000;width:200px;height:400px;box-shadow:0 0 9px #222;margin:0 40px 40px">',A=0;K>A;A++)B.push(0),A>19&&220>A&&(z+='<div id="tis-'+A+C);z+="</div></div>",m=i[o]("div"),m.innerHTML=z,i.body.appendChild(m),C=881856,m=new Uint8Array(C+44),m.set([82,73,70,70,C+36&255,C+36>>8&255,C+36>>16,0,87,65,86,69,102,109,116,32,16,0,0,0,1,0,1,0,34,86,0,0,34,86,0,0,1,0,8,0,100,97,116,97,255&C,C>>8&255,C>>16,0]),T[2]+=T[2];for(v in O)for(O[v]+=O[v]+T[v],A=44,w=0;w<O[v].length;w++)for(L=O[v][n](w)-(2==v?64:32),y=.00499*a.pow(2,(L%24+(2==v?0:27))/12),C=[15,9,9][v],k=0;k<4593*[1,3,2,4][~~(L/24)];k++)m[A++]=(m[A]||127)+(1>k*y%2?C:-C),C*=.9999;O=i[o]("audio"),O.src=URL.createObjectURL(new Blob([m],{type:"audio/wav"})),O.loop=1,"#m"!=location.hash&&O.play(),p(0),i[t]("keydown",function(e){m=e[s],77==m&&(O.paused?O.play():O.pause()),R[m]||(R[m]=0),(m>36&&41>m||88==m||88==m||90==m||186==m)&&e.preventDefault()}),i[t]("keyup",function(e){delete R[e[s]]})}var i=document,t="addEventListener",o="createElement",r="getElementById",a=Math,n="charCodeAt",s="keyCode",d="&&((%'%'BA",f=0;i[t]("keydown",function(i){f=i[s]==d[n](f)?f+1:0,f>9&&e()})}();