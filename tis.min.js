!function(){var t=document,e="addEventListener",i="charCodeAt",o="keyCode",r="keydown",n=0;t[e](r,function(f){n=f[o]=="&&((%'%'BA"[i](n)?n+1:0,n>9&&!function(){function n(t){return Y=t.length,Y=new Audio(URL.createObjectURL(new Blob(["RIFF",new Uint32Array([Y+36,1163280727,544501094,16,65537,22050,22050,524289,1635017060,Y]),t],{type:"audio/wav"}))),Y.play(),Y}function f(t,e,i){Y=new Uint8Array(9e3),L=50;for(v in Y)v>1e3&&(t=e),Y[v]=127+(L*=1-i)*(t/2>v%t?-1:1);n(Y,1)}function p(t,e,o,r){return S&&!(-4&t)&&!(-4&e)&&F[i](8*(r||S)-8+2*o+(e>>1))&1<<4*(1&e)+t}function a(){for(N=h;S&&s(c,h+1,l,1););for(m=0;j+4>m;m++)for(y=0;$>y;y++)v=m*$+y,m>=j&&(J[v]=p(y,m-j,0,z[0])?z[0]:0),U[v]=p(y-c,m-N,l)?S:p(y-c,m-h,l)?S+8:J[v]||0,(O=k["tis-"+v])&&(O=O.style,O.background="#"+(1==Q&&2>A%4&&g[m]?"fff":D[U[v]%8]),O.opacity=U[v]>7?.2:1);h=N,N=te+'0;text-align:right;font-size:150%">',k["tis-status"].innerHTML="Score"+N+P+ee+"Lines"+N+V+ee+"Level"+N+W+ee}function s(t,e,i,o){for(L=0;y=3&L,m=L>>2,16>L;L++)if(p(y,m,i)&&((y+=t)<0||y>=$||(m+=e)<0||m>=j||J[m*$+y]))return;return c=t,h=e,l=i,X=0,o||a(),1}function d(e){if(w=(e-C)/1e3||0,w>.1&&(w=.1),C=e,2==Q){if(A-->4&&!(A%4)){for(y=0;$>y;)J[A*$/4+y++]=1+~~(7*M.random());a()}}else if(1==Q){if(--A<0){for(m in g)for(v=m*$+$-1;v>=0;v--)J[v]=J[v-$];Q=0}a()}else{for(T in _){if(27==T)return t.body.removeChild(oe),t[E](r,u),t[E](K,x),void G.pause();if((37==T||39==T)&&_[T]>=0&&(_[T]-=_[T]?.05:.2,s(c+1-2*(37==T),h,l)),38==T&&!_[T]){for(;s(c,h+1,l););X=9}if((16==T||17==T)&&(B=1-2*(17==T),!_[T]))for(v=0;5>v;)if(N=(1==S?H:Z)[i]((l+4+(B-1)/2)%4*5+v++)-32,s(c+B*((7&N)-2),h+B*(2-(N>>3)),(l+4+B)%4)){f(80,60,.0015);break}_[T]+=w}if(b+=M.max(_[40]?.2:0,w*M.pow(1.23,W)),b>1&&(b=0,s(c,h+1,l)),!S||X>1){S&&f(300,450,5e-4);for(v in J)J[v]=U[v];T=0,g=[];t:for(m=0;j>m;m++){for(y=0;$>y;)if(!J[m*$+y++])continue t;g[m]=1,T++,Q=1,A=6}if(T&&f(80,80/T,.001/T),P+=100*[0,1,3,5,8][T]*W,V+=T,W=1+~~(V/10),z.length<2)for(N=1;255!=N;){for(L=0;N&1<<L;L=1+~~(7*M.random()));N|=1<<L,z.push(L)}S=z.shift(),b=0,s(3,0,0)||(S=0,Q=2,A=4*j,f(300,400,0))}X+=w}requestAnimationFrame(d)}function u(t){N=t[o],77==N&&(G.paused?G.play():G.pause()),_[N]||(_[N]=0),(N>36&&41>N||81==N||88==N||90==N||186==N)&&t.preventDefault()}function x(t){delete _[t[o]]}var S,c,h,l,A,g,w,b,C,v,L,y,m,N,T,O,B,Y,k=window,q="createElement",E="removeEventListener",K="keyup",M=Math,G=["`+,^,+Y),`.,C,^`\\Yq^.1e31H,01.,C,^`\\Yq","T$$T,+)$),Y))<$TTYTl.).1^..D,\\.,<$TTTTT`","GNKNGNKNLSOSLSOSKSNSKSNSLSNSL@BCESOSESOSCOCOCOCOBNBN?J?J@CGL@@@@"],I=["xtvstqpsxtvs\\`}|x","tqspqqpptqspY`xx","LSOSLSOSKSNSKSNSLSOSLSOSKSNSKSNS"],J=[],U=[],$=10,j=22,R=$*j+20,D="08080890dd936f9e809dd090e09c0c9f22".split(9),F=atob("8ABERAAPIiJxACYCcAQiA3QAIgZwASMCZgBmAGYAZgA2AGIEYAMxAnIAYgJwAjICYwBkAjAGMgE"),H="203(C214A,241<!230#8",Z='219"!23+BC23;"#21)BA',z=[],Q=0,P=0,V=0,W=1,X=0,_=[],te='<div style="margin:',ee="</div>",ie=";box-shadow:",oe=te+"-270px -180px;position:fixed;width:360px;left:50%;top:50%;font:13px sans-serif;background:rgba(0,0,0,.8)"+ie+'0 0 30px #000;border-radius:30px">'+te+'20px 40px;color:#888"><b><a href="http://github.com/ttencate/tis" style="color:inherit">Tis</a></b>: Tetris in just 4 kB of JavaScript<br><br>Left/right: move | Shift/Ctrl: rotate<br>Down/up: soft/hard drop | M: music | Esc: quit'+ee+te+'0 20px;float:right;width:80px;color:#eee;font-size:15px"><div id="tis-status">'+ee+"Next"+te+"8px 0;height:40px"+ie+'0 0 9px #000">';for(T=te+"0;width:20px;height:20px;float:left"+ie+'-2px -2px 8px rgba(0,0,0,.4) inset,0 0 2px #000 inset" id="tis-',v=220;R>v;v++)4>v%$&&(oe+=T+v+'">'+ee);for(oe+=ee+ee+te+"0 40px 40px;background:#000;width:200px;height:400px"+ie+'0 0 9px #222">',v=0;R>v;v++)J.push(0),v>19&&220>v&&(oe+=T+v+'">'+ee);oe+=ee+ee,N=t[q]("div"),N.innerHTML=oe,t.body.appendChild(oe=N),N=new Uint8Array(881856),I[2]+=I[2];for(w in G)for(G[w]+=G[w]+I[w],v=0,L=0;L<G[w].length;)for(O=G[w][i](L++)-(2==w?64:32),y=.00499*M.pow(2,(O%24+(2==w?0:27))/12),T=[15,9,9][w],m=0;m<4593*[1,3,2,4][~~(O/24)];)N[v++]=(N[v]||127)+(m++*y%2<1?T:-T),T*=.9999;G=n(N),G.loop=1,d(0),t[e](r,u),t[e](K,x)}()})}();