!function(){var e=document,t="addEventListener",i="charCodeAt",o="keyCode",r="keydown",n=0,f=27;e[t](r,function(p){n=p[o]=="&&((%'%'BA"[i](n)?n+1:0,27==f&&n>9&&!function(){function n(e){return N=e.length,new Audio(URL.createObjectURL(new Blob(["RIFF",new Uint32Array([N+36,1163280727,544501094,16,65537,22050,22050,524289,1635017060,N]),e],{type:"audio/wav"})))}function p(e,t,o,r){return l&&!(-4&e)&&!(-4&t)&&D[i](8*(r||l)-8+2*o+(t>>1))&1<<4*(1&t)+e}function a(){for(N=S;l&&s(c,S+1,h,1););for(m=0;$+4>m;m++)for(L=0;J>L;L++)C=m*J+L,m>=$&&(I[C]=p(L,m-$,0,Z[0])?Z[0]:0),U[C]=p(L-c,m-N,h)?l:p(L-c,m-S,h)?l+8:I[C]||0,(O=B["tis-"+C])&&(O=O.style,O.background="#"+(1==z&&2>A%4&&g[m]?"fff":j[U[C]%8]),O.opacity=U[C]>7?.2:1);S=N,N=_+'0;text-align:right;font-size:150%">',B["tis-status"].innerHTML="Score"+N+Q+et+"Lines"+N+P+et+"Level"+N+V+et}function s(e,t,i,o){for(v=0;L=3&v,m=v>>2,16>v;v++)if(p(L,m,i)&&((L+=e)<0||L>=J||(m+=t)<0||m>=$||I[m*J+L]))return;return c=e,S=t,h=i,W=0,o||a(),1}function d(t){if(w=(t-y)/1e3||0,w>.1&&(w=.1),y=t,2==z){if(A-->4&&!(A%4)){for(L=0;J>L;)I[A*J/4+L++]=1+~~(7*E.random());a()}}else if(1==z){if(--A<0){for(m in g)for(C=m*J+J-1;C>=0;C--)I[C]=I[C-J];z=0}a()}else{for(f in X){if(27==f)return e.body.removeChild(it),e[k](r,x),e[k](q,u),void K.pause();if((37==f||39==f)&&X[f]>=0&&(X[f]-=X[f]?.05:.2,s(c+1-2*(37==f),S,h)),32==f&&!X[f]){for(;s(c,S+1,h););W=9}if((38==f||18==f||17==f)&&(T=1-2*(17==f),!X[f]))for(C=0;5>C;)if(N=(1==l?F:H)[i]((h+4+(T-1)/2)%4*5+C++)-32,s(c+T*((7&N)-2),S+T*(2-(N>>3)),(h+4+T)%4)){G[0].play();break}X[f]+=w}if(b+=E.max(X[40]?.2:0,w*E.pow(1.23,V)),b>1&&(b=0,s(c,S+1,h)),W>1){l&&G[1].play();for(C in I)I[C]=U[C];f=0,g=[];e:for(m=0;$>m;m++){for(L=0;J>L;)if(!I[m*J+L++])continue e;g[m]=z=1,f++,A=6}if(f&&G[1+f].play(),Q+=100*[0,1,3,5,8][f]*V,P+=f,V=1+~~(P/10),Z.length<2)for(N=1;255!=N;){for(v=0;N&1<<v;v=1+~~(7*E.random()));N|=1<<v,Z.push(v)}l=Z.shift(),b=0,s(3,0,0)||(l=0,z=2,A=4*$,G[6].play())}W+=w}requestAnimationFrame(d)}function x(e){N=e[o],77==N&&K[K.paused?"play":"pause"](),X[N]=X[N]||0,[17,18,27,37,38,39,40,77].indexOf(N)>=0&&e.preventDefault()}function u(e){delete X[e[o]]}var l,c,S,h,A,g,w,b,y,C,v,L,m,N,O,T,B=window,Y="createElement",k="removeEventListener",q="keyup",E=Math,K=["`+,^,+Y),`.,C,^`\\Yq^.1e31H,01.,C,^`\\Yq","T$$T,+)$),Y))<$TTYTl.).1^..D,\\.,<$TTTTT`","GNKNGNKNLSOSLSOSKSNSKSNSLSNSL@BCESOSESOSCOCOCOCOBNBN?J?J@CGL@@@@"],M=["xtvstqpsxtvs\\`}|x","tqspqqpptqspY`xx","LSOSLSOSKSNSKSNSLSOSLSOSKSNSKSNS"],G=[[80,60,.0015],[300,450,5e-4],[80,80,.001],[80,40,5e-4],[80,30,2e-4],[80,20,1e-4],[300,400,0]],I=[],U=[],J=10,$=22,R=J*$+20,j="08080890dd936f9e809dd090e09c0c9f22".split(9),D=atob("8ABERAAPIiJxACYCcAQiA3QAIgZwASMCZgBmAGYAZgA2AGIEYAMxAnIAYgJwAjICYwBkAjAGMgE"),F="203(C214A,241<!230#8",H='219"!23+BC23;"#21)BA',Z=[],z=0,Q=0,P=0,V=1,W=2,X=[],_='<div style="margin:',et="</div>",tt=";box-shadow:",it=_+"-270px -180px;position:fixed;width:360px;left:50%;top:50%;font:13px sans-serif;background:rgba(0,0,0,.8)"+tt+'0 0 30px #000;border-radius:30px">'+_+'20px 40px;color:#888"><b><a href="http://github.com/ttencate/tis" style="color:inherit">Tis</a></b>: Tetris in 4 kB of JavaScript<br><br>Left/right: move | Up/Ctrl/Alt: rotate | Esc: quit<br>Down/space: soft/hard drop | M: music'+et+_+'0 20px;float:right;width:80px;color:#eee;font-size:15px"><div id="tis-status">'+et+"Next"+_+"8px 0;height:40px"+tt+'0 0 9px #000">';for(f=_+"0;width:20px;height:20px;float:left"+tt+'-2px -2px 8px rgba(0,0,0,.4) inset,0 0 2px #000 inset" id="tis-',C=220;R>C;C++)4>C%J&&(it+=f+C+'">'+et);for(it+=et+et+_+"0 40px 40px;background:#000;width:200px;height:400px"+tt+'0 0 9px #222">',C=0;R>C;C++)I.push(0),C>19&&220>C&&(it+=f+C+'">'+et);it+=et+et,N=e[Y]("div"),N.innerHTML=it,e.body.appendChild(it=N),N=new Uint8Array(881856),M[2]+=M[2];for(w in K)for(K[w]+=K[w]+M[w],C=0,v=0;v<K[w].length;)for(O=K[w][i](v++)-(2==w?64:32),L=.00499*E.pow(2,(O%24+(2==w?0:27))/12),f=[15,9,9][w],m=0;m<4593*[1,3,2,4][~~(O/24)];)N[C++]=(N[C]||127)+(m++*L%2<1?f:-f),f*=.9999;K=n(N),K.play(),K.loop=1;for(C in G){T=G[C],N=new Uint8Array(9e3),f=50,O=T[0];for(v in N)v>1e3&&(O=T[1]),N[v]=127+(f*=1-T[2])*(O/2>v%O?-1:1);G[C]=n(N)}d(0),e[t](r,x),e[t](q,u)}()})}();