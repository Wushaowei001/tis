document.addEventListener("DOMContentLoaded",function(){function e(e,t,i,o){return d&&(3&e)==e&&(3&t)==t&&E[o||d][i]&1<<4*t+e}function t(){for(g=n;d&&i(s,n+1,f,1););for(b=0;K+4>b;b++)for(v=0;q>v;v++)u=b*q+v,b>=K&&(M[u]=e(v,b-K,0,R[0])?R[0]:0),T[u]=e(v-s,b-g,f)?d:e(v-s,b-n,f)?d+8:M[u]||0,(L=k[C]("tis-"+u))&&(L.style.background="#"+(1==G&&2>p%4&&h[b]?"fff":A[T[u]%8]),L.style.opacity=T[u]>7?.2:1);n=g,g='<div style="text-align:right;font-size:150%">',k[C]("tis-status").innerHTML="Score"+g+H+"</div>Lines"+g+I+"</div>Level"+g+U+"</div>"}function i(i,o,a,r){for(b=o;o+4>b;b++)for(v=i;i+4>v;v++)if(e(v-i,b-o,a)&&(0>v||v>=q||0>b||b>=K||M[b*q+v]))return 0;return s=i,n=o,f=a,J=0,r||t(),1}function o(e){switch(x=(e-l)/1e3||0,x>.1&&(x=.1),l=e,G){case 2:if(p-->4&&!(p%4)){for(v=0;q>v;v++)M[p*q/4+v]=1+Math.floor(7*Math.random());t()}break;case 1:if(--p<0){for(b in h)for(u=b*q+q-1;u>=0;u--)M[u]=M[u-q];G=0}t();break;case 0:w=1;for(y in j){switch(parseInt(y)){case 37:if(j[y]<0)break;j[y]-=D,i(s-1,n,f);break;case 39:if(j[y]<0)break;j[y]-=D,i(s+1,n,f);break;case 38:if(j[y])break;for(;i(s,n+1,f););J=9;break;case 90:case 186:w=-1;case 88:case 81:if(!j[y])for(u=0;5>u&&(g=(1==d?Y:$).charCodeAt((f+4+(w-1)/2)%4*5+u)-32,!i(s+w*((7&g)-2),n+w*(2-(g>>3)),(f+4+w)%4));u++);}j[y]+=x}if(c+=Math.max(j[40]?.2:0,x*(U+1)/1.5),c>1&&(c=0,i(s,n+1,f)),!d||J>1){for(t(),u=0;B>u;u++)M[u]=T[u];for(y=0,h=[],b=0;K>b;b++){for(g=1,v=0;q>v;v++)if(!M[b*q+v]){g=0;break}g&&(h[b]=1,y++,G=1,p=6)}if(H+=[0,100,300,500,800][y]*U,I+=y,U=1+Math.floor(I/10),R.length<2)for(g=1,u=0;7>u;u++){for(S=0;g&1<<S;)S=Math.ceil(7*Math.random());g|=1<<S,R.push(S)}d=R.shift(),c=0,i(3,0,0)||(G=2,p=4*K),t()}J+=x}window.requestAnimationFrame(o)}function a(e){g=e.keyCode,77==g&&(g=k[C]("tis-music"),g.paused?g.play():g.pause()),j[g]||(j[g]=0),(g>36&&41>g||88==g||88==g||90==g||186==g)&&e.preventDefault()}function r(e){delete j[e.keyCode]}var d,s,n,f,p,h,c,x,l,u,S,v,b,g,y,L,w,k=document,C="getElementById",m="addEventListener",N=["`+,^,+Y),`.,C,^`\\Yq^.1e31H,01.,C,^`\\Yq","T$$T,+)$),Y))<$TTYTl.).1^..D,\\.,<$TTTTT`","GNKNGNKNLSOSLSOSKSNSKSNSLSNSL@BCESOSESOSCOCOCOCOBNBN?J?J@CGL@@@@"],O=["xtvstqpsxtvs\\`}|x","tqspqqpptqspY`xx","LSOSLSOSKSNSKSNSLSOSLSOSKSNSKSNS"],M=[],T=[],q=10,K=22,B=q*K+20,A="080808 0dd 36f e80 dd0 0e0 c0c f22".split(" "),E=[,[240,17476,3840,8738],[113,550,1136,802],[116,1570,368,547],[102,102,102,102],[54,1122,864,561],[114,610,624,562],[99,612,1584,306]],Y="203(C214A,241<!230#8",$='219"!23+BC23;"#21)BA',D=.15,G=0,H=0,I=0,U=1,J=0,R=[],j=[],z='<div id="tis-root" style="position:fixed;width:280px;height:400px;left:50%;top:50%;margin:-240px -160px;background:rgba(0,0,0,0.8);box-shadow:0 0 30px #000;border-radius:30px;padding:40px"><div id="tis-grid" style="background:#000;width:200px;height:400px;box-shadow:0 0 9px #222;">';O[2]+=O[2];for(u in N)N[u]+=N[u]+O[u];for(y='" style="width:20px;height:20px;float:left;box-shadow:-2px -2px 8px rgba(0,0,0,0.4) inset, 0 0 2px #000 inset;"></div>',u=0;B>u;u++)M.push(0),u>19&&220>u&&(z+='<div id="tis-'+u+y);for(z+='</div><div style="position:absolute;right:20px;top:40px;width:80px;color:#eee;font:normal 15px sans-serif"><div id="tis-status"></div>Next<div style="margin:8px 0;height:40px;box-shadow:0 0 9px #000;">',u=220;B>u;u++)4>u%q&&(z+='<div id="tis-'+u+y);for(z+="</div></div></div>",y=881856,g=new Uint8Array(y+44),g.set([82,73,70,70,y+36&255,y+36>>8&255,y+36>>16,0,87,65,86,69,102,109,116,32,16,0,0,0,1,0,1,0,34,86,0,0,34,86,0,0,1,0,8,0,100,97,116,97,255&y,y>>8&255,y>>16,0]),x=0;3>x;x++)for(u=44,S=0;S<N[x].length;S++)for(L=N[x].charCodeAt(S)-(2==x?64:32),v=2*Math.PI*(2==x?55:261.63)*Math.pow(2,L%24/12)/22050,y=[.2,.1,.1][x],b=0;b<4593*[1,3,2,4][Math.floor(L/24)];b++)g[u++]+=127*(!x+y*(Math.sin(b*v)>0?1:-1)),y*=.9999;z+='<audio id="tis-music" src="'+URL.createObjectURL(new Blob([g],{type:"audio/wav"}))+'" loop'+("#m"==location.hash?"":" autoplay")+"></audio>",g=k.createElement("div"),g.innerHTML=z,k.body.appendChild(g),o(0),k[m]("keydown",a),k[m]("keyup",r)});