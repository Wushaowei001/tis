!function(){var t=document,e="addEventListener",i="charCodeAt",o="keyCode",r="keydown",n=0;t[e](r,function(f){n=f[o]=="&&((%'%'BA"[i](n)?n+1:0,n>9&&!function(){function n(t,e,o,r){return x&&!(-4&t)&&!(-4&e)&&j[i](8*(r||x)-8+2*o+(e>>1))&1<<4*(1&e)+t}function f(){for(w=S;x&&p(u,S+1,c,1););for(m=0;J+4>m;m++)for(L=0;I>L;L++)v=m*I+L,m>=J&&(M[v]=n(L,m-J,0,R[0])?R[0]:0),G[v]=n(L-u,m-w,c)?x:n(L-u,m-S,c)?x+8:M[v]||0,(N=t[B]("tis-"+v))&&(N=N.style,N.background="#"+(1==U&&2>h%4&&l[m]?"fff":Z[G[v]%8]),N.opacity=G[v]>7?.2:1);S=w,w=V+'0;text-align:right;font-size:150%">',t[B]("tis-status").innerHTML="Score"+w+z+W+"Lines"+w+Q+W+"Level"+w+F+W}function p(t,e,i,o){for(C=0;L=3&C,m=C>>2,16>C;C++)if(n(L,m,i)&&((L+=t)<0||L>=I||(m+=e)<0||m>=J||M[m*I+L]))return;return u=t,S=e,c=i,P=0,o||f(),1}function a(e){if(A=(e-b)/1e3||0,A>.1&&(A=.1),b=e,2==U){if(h-->4&&!(h%4)){for(L=0;I>L;L++)M[h*I/4+L]=1+~~(7*E.random());f()}}else if(1==U){if(--h<0){for(m in l)for(v=m*I+I-1;v>=0;v--)M[v]=M[v-I];U=0}f()}else{for(y in X){if(27==y)return t.body.removeChild(te),t[Y](r,s),t[Y](k,d),void q.pause();if(37==y&&X[y]>=0&&(X[y]-=.15,p(u-1,S,c)),39==y&&X[y]>=0&&(X[y]-=.15,p(u+1,S,c)),38==y){if(X[y])break;for(;p(u,S+1,c););P=9}if(((O=90==y||186==y)||88==y||81==y)&&(O=1-2*O,!X[y]))for(v=0;5>v&&(w=(1==x?D:H)[i]((c+4+(O-1)/2)%4*5+v)-32,!p(u+O*((7&w)-2),S+O*(2-(w>>3)),(c+4+O)%4));v++);X[y]+=A}if(g+=E.max(X[40]?.2:0,A*E.pow(1.23,F)),g>1&&(g=0,p(u,S+1,c)),!x||P>1){for(v in M)M[v]=G[v];for(y=0,l=[],m=0;J>m;m++){for(w=1,L=0;I>L;L++)if(!M[m*I+L]){w=0;break}w&&(l[m]=1,y++,U=1,h=6)}if(z+=100*[0,1,3,5,8][y]*F,Q+=y,F=1+~~(Q/10),R.length<2)for(w=1;255!=w;){for(C=0;w&1<<C;C=E.ceil(7*E.random()));w|=1<<C,R.push(C)}x=R.shift(),g=0,p(3,0,0)||(x=0,U=2,h=4*J)}P+=A}requestAnimationFrame(a)}function s(t){w=t[o],77==w&&(q.paused?q.play():q.pause()),X[w]||(X[w]=0),(w>36&&41>w||81==w||88==w||90==w||186==w)&&t.preventDefault()}function d(t){delete X[t[o]]}var x,u,S,c,h,l,A,g,b,v,C,L,m,w,y,N,O,T="createElement",B="getElementById",Y="removeEventListener",k="keyup",E=Math,q=["`+,^,+Y),`.,C,^`\\Yq^.1e31H,01.,C,^`\\Yq","T$$T,+)$),Y))<$TTYTl.).1^..D,\\.,<$TTTTT`","GNKNGNKNLSOSLSOSKSNSKSNSLSNSL@BCESOSESOSCOCOCOCOBNBN?J?J@CGL@@@@"],K=["xtvstqpsxtvs\\`}|x","tqspqqpptqspY`xx","LSOSLSOSKSNSKSNSLSOSLSOSKSNSKSNS"],M=[],G=[],I=10,J=22,$=I*J+20,Z="080808 0dd 36f e80 dd0 0e0 c0c f22".split(" "),j=atob("8ABERAAPIiJxACYCcAQiA3QAIgZwASMCZgBmAGYAZgA2AGIEYAMxAnIAYgJwAjICYwBkAjAGMgE"),D="203(C214A,241<!230#8",H='219"!23+BC23;"#21)BA',R=[],U=0,z=0,Q=0,F=1,P=0,X=[],V='<div style="margin:',W="</div>",_=";box-shadow:",te=V+"-270px -180px;position:fixed;width:360px;left:50%;top:50%;font:13px sans-serif;background:rgba(0,0,0,.8)"+_+'0 0 30px #000;border-radius:30px">'+V+'20px 40px;color:#888"><b><a href="http://github.com/ttencate/tis" style="color:inherit">Tis</a></b>: 4 kB of JavaScript<br><br>Left/right: move | Z/X: rotate<br>Down/up: soft/hard drop | M: music | Esc: quit'+W+V+'0 20px;float:right;width:80px;color:#eee;font-size:15px"><div id="tis-status">'+W+"Next"+V+"8px 0;height:40px"+_+'0 0 9px #000">';for(y=V+"0;width:20px;height:20px;float:left"+_+'-2px -2px 8px rgba(0,0,0,.4) inset,0 0 2px #000 inset" id="tis-',v=220;$>v;v++)4>v%I&&(te+=y+v+'">'+W);for(te+=W+W+V+"0 40px 40px;background:#000;width:200px;height:400px"+_+'0 0 9px #222">',v=0;$>v;v++)M.push(0),v>19&&220>v&&(te+=y+v+'">'+W);te+=W+W,w=t[T]("div"),w.innerHTML=te,t.body.appendChild(te=w),y=881856,w=new Uint8Array(y+44),w.set([82,73,70,70,y+36&255,y+36>>8&255,y+36>>16,0,87,65,86,69,102,109,116,32,16,0,0,0,1,0,1,0,34,86,0,0,34,86,0,0,1,0,8,0,100,97,116,97,255&y,y>>8&255,y>>16,0]),K[2]+=K[2];for(A in q)for(q[A]+=q[A]+K[A],v=44,C=0;C<q[A].length;C++)for(N=q[A][i](C)-(2==A?64:32),L=.00499*E.pow(2,(N%24+(2==A?0:27))/12),y=[15,9,9][A],m=0;m<4593*[1,3,2,4][~~(N/24)];m++)w[v++]=(w[v]||127)+(1>m*L%2?y:-y),y*=.9999;q=new Audio(URL.createObjectURL(new Blob([w],{type:"audio/wav"}))),q.loop=1,"#m"!=location.hash&&q.play(),a(0),t[e](r,s),t[e](k,d)}()})}();