!function(){var t,e,i,o,a,r,s,d,n,f,p,h,c,x,l,u=document,S="getElementById",v="addEventListener",b=["`+,^,+Y),`.,C,^`\\Yq^.1e31H,01.,C,^`\\Yq","T$$T,+)$),Y))<$TTYTl.).1^..D,\\.,<$TTTTT`","GNKNGNKNLSOSLSOSKSNSKSNSLSNSL@BCESOSESOSCOCOCOCOBNBN?J?J@CGL@@@@"],g=["xtvstqpsxtvs\\`}|x","tqspqqpptqspY`xx","LSOSLSOSKSNSKSNSLSOSLSOSKSNSKSNS"],y=[],w=[],L=10,k=22,m=L*k+20,N="080808 0dd 36f e80 dd0 0e0 c0c f22".split(" "),O=[,[240,17476,3840,8738],[113,550,1136,802],[116,1570,368,547],[102,102,102,102],[54,1122,864,561],[114,610,624,562],[99,612,1584,306]],C=.15,M=0,T=0,q=0,K=1,Y=0,B=[],E=[],$='<div id="tis-root" style="position:fixed;width:280px;height:400px;left:50%;top:50%;margin:-240px -160px;background:rgba(0,0,0,0.8);box-shadow:0 0 30px #000;border-radius:30px;padding:40px"><div id="tis-grid" style="background:#000;width:200px;height:400px;box-shadow:0 0 9px #222;">';u[v]("DOMContentLoaded",function(){function A(e,i,o,a){return t&&(3&e)==e&&(3&i)==i&&O[a||t][o]&1<<4*i+e}function D(){for(c=i;t&&G(e,i+1,o,1););for(h=0;k+4>h;h++)for(p=0;L>p;p++)n=h*L+p,h>=k&&(y[n]=A(p,h-k,0,B[0])?B[0]:0),w[n]=A(p-e,h-c,o)?t:A(p-e,h-i,o)?t+8:y[n]||0,(l=u[S]("tis-"+n))&&(l.style.background="#"+N[w[n]%8],l.style.opacity=w[n]>7?.2:1);i=c,c='<div style="text-align:right;font-size:150%">',u[S]("tis-status").innerHTML="Score"+c+T+"</div>Lines"+c+q+"</div>Level"+c+K+"</div>"}function G(t,a,r,s){for(h=a;a+4>h;h++)for(p=t;t+4>p;p++)if(A(p-t,h-a,r)&&(0>p||p>=L||0>h||h>=k||y[h*L+p]))return 0;return e=t,i=a,o=r,Y=0,s||D(),1}function H(l){switch(s=(l-d)/1e3||0,s>.1&&(s=.1),d=l,M){case 1:if(a>1){for(p=0;L>p;p++)y[a*L+p]=1+Math.floor(7*Math.random());D(),a--}break;case 0:for(x in E){switch(parseInt(x)){case 37:if(E[x]<0)break;E[x]-=C,G(e-1,i,o);break;case 39:if(E[x]<0)break;E[x]-=C,G(e+1,i,o);break;case 38:if(E[x])break;for(;G(e,i+1,o););Y=9;break;case 90:case 186:E[x]||G(e,i,(o+3)%4);break;case 88:case 81:E[x]||G(e,i,(o+1)%4)}E[x]+=s}if(r+=Math.max(E[40]?.2:0,s*(K+1)/1.5),r>1&&(r=0,G(e,i+1,o)),!t||Y>1){for(D(),n=0;m>n;n++)y[n]=w[n];for(x=0,h=0;k>h;h++){for(c=1,p=0;L>p;p++)if(!y[h*L+p]){c=0;break}if(c)for(x++,n=h*L+L-1;n>=0;n--)y[n]=y[n-L]}if(T+=[0,100,300,500,800][x]*K,q+=x,K=1+Math.floor(q/10),B.length<2)for(c=1,n=0;7>n;n++){for(f=0;c&1<<f;)f=Math.ceil(7*Math.random());c|=1<<f,B.push(f)}t=B.shift(),r=0,G(3,0,0)||(M=1,a=k),D()}Y+=s}window.requestAnimationFrame(H)}function I(t){c=t.keyCode,77==c&&(c=u[S]("tis-music"),c.paused?c.play():c.pause()),E[c]||(E[c]=0),(c>36&&41>c||88==c||88==c||90==c||186==c)&&t.preventDefault()}function U(t){delete E[t.keyCode]}g[2]+=g[2];for(n in b)b[n]+=b[n]+g[n];for(x='" style="width:20px;height:20px;float:left;box-shadow:-2px -2px 8px rgba(0,0,0,0.4) inset, 0 0 2px #000 inset;"></div>',n=0;m>n;n++)y.push(0),n>19&&220>n&&($+='<div id="tis-'+n+x);for($+='</div><div style="position:absolute;right:20px;top:40px;width:80px;color:#eee;font:normal 15px sans-serif"><div id="tis-status"></div>Next<div style="margin:8px 0;height:40px;box-shadow:0 0 9px #000;">',n=220;m>n;n++)4>n%L&&($+='<div id="tis-'+n+x);for($+="</div></div></div>",x=881856,c=new Uint8Array(x+44),c.set([82,73,70,70,x+36&255,x+36>>8&255,x+36>>16,0,87,65,86,69,102,109,116,32,16,0,0,0,1,0,1,0,34,86,0,0,34,86,0,0,1,0,8,0,100,97,116,97,255&x,x>>8&255,x>>16,0]),s=0;3>s;s++)for(n=44,f=0;f<b[s].length;f++)for(l=b[s].charCodeAt(f)-(2==s?64:32),p=2*Math.PI*(2==s?55:261.63)*Math.pow(2,l%24/12)/22050,x=[.2,.1,.1][s],h=0;h<4593*[1,3,2,4][Math.floor(l/24)];h++)c[n++]+=127*(!s+x*(Math.sin(h*p)>0?1:-1)),x*=.9999;$+='<audio id="tis-music" src="'+URL.createObjectURL(new Blob([c],{type:"audio/wav"}))+'" loop'+("#m"==location.hash?"":" autoplay")+"></audio>",c=u.createElement("div"),c.innerHTML=$,u.body.appendChild(c),H(0),u[v]("keydown",I),u[v]("keyup",U)})}();