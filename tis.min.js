!function(){var e=document,t="addEventListener",i="charCodeAt",r="keyCode",o="keydown",n=0,f=27;e[t](o,function(p){n=p[r]=="&&((%'%'BA"[i](n)?n+1:0,27==f&&n>9&&!function(){function n(e){if(Y=U[e])Y.currentTime=0;else{Y=new Uint8Array(9e3),B=50;for(y in Y)O=y>1e3?e>>4&63:e>>10,Y[y]=127+(B*=1-(15&e)/1e4)*(O/2>y/10%O?-1:1);Y=U[L]=p(Y)}Y.play()}function p(e){return Y=e.length,new Audio(URL.createObjectURL(new Blob(["RIFF",new Uint32Array([Y+36,1163280727,544501094,16,65537,22050,22050,524289,1635017060,Y]),e],{type:"audio/wav"})))}function c(e,t,r,o){return S&&!(-4&e)&&!(-4&t)&&H[i](8*(o||S)-8+2*r+(t>>1))&1<<4*(1&t)+e}function a(){for(N=A;S&&s(h,A+1,g,1););for(T=0;j+4>T;T++)for(m=0;R>m;m++)L=T*R+m,T>=j&&(J[L]=c(m,T-j,0,Q[0])?Q[0]:0),$[L]=c(m-h,T-N,g)?S:c(m-h,T-A,g)?S+8:J[L]||0,(O=k["tis-"+L])&&(O=O.style,O.background="#"+(1==P&&2>x%4&&w[T]?"fff":F[$[L]%8]),O.opacity=$[L]>7?.2:1);A=N,N=tt+'0;text-align:right;font-size:150%">',k["tis-status"].innerHTML="Score"+N+V+it+"Lines"+N+W+it+"Level"+N+X+it}function s(e,t,i,r){for(y=0;m=3&y,T=y>>2,16>y;y++)if(c(m,T,i)&&((m+=e)<0||m>=R||(T+=t)<0||T>=j||J[T*R+m]))return;return h=e,A=t,g=i,_=0,r||a(),1}function d(t){if(b=(t-v)/1e3||0,b>.1&&(b=.1),v=t,2==P){if(x-->4&&!(x%4)){for(m=0;R>m;)J[x*R/4+m++]=1+~~(7*M.random());a()}}else if(1==P){if(--x<0){for(T in w)for(L=T*R+R-1;L>=0;L--)J[L]=J[L-R];P=0}a()}else{for(f in et){if(27==f)return e.body.removeChild(ot),e[E](o,u),e[E](K,l),void G.pause();if((37==f||39==f)&&et[f]>=0&&(et[f]-=et[f]?.05:.2,s(h+1-2*(37==f),A,g)),32==f&&!et[f]){for(;s(h,A+1,g););_=9}if((38==f||18==f||17==f)&&(B=1-2*(17==f),!et[f]))for(L=0;5>L;)if(N=(1==S?Z:z)[i]((g+4+(B-1)/2)%4*5+L++)-32,s(h+B*((7&N)-2),A+B*(2-(N>>3)),(g+4+B)%4)){n(8303);break}et[f]+=b}if(C+=M.max(et[40]?.2:0,b*M.pow(1.23,X)),C>1&&(C=0,s(h,A+1,g)),_>1){S&&n(31445);for(L in J)J[L]=$[L];f=0,w=[];e:for(T=0;j>T;T++){for(m=0;R>m;)if(!J[T*R+m++])continue e;w[T]=P=1,f++,x=6}if(f&&n([,8392,8260,8242,8225][f]),V+=100*[0,1,3,5,8][f]*X,W+=f,X=1+~~(W/10),Q.length<2)for(N=1;255!=N;){for(y=0;N&1<<y;y=1+~~(7*M.random()));N|=1<<y,Q.push(y)}S=Q.shift(),C=0,s(3,0,0)||(S=0,P=2,x=4*j,n(31360))}_+=b}requestAnimationFrame(d)}function u(e){N=e[r],77==N&&G[G.paused?"play":"pause"](),et[N]=et[N]||0,[17,18,27,37,38,39,40,77].indexOf(N)>=0&&e.preventDefault()}function l(e){delete et[e[r]]}var S,h,A,g,x,w,b,C,v,L,y,m,T,N,O,B,Y,k=window,q="createElement",E="removeEventListener",K="keyup",M=Math,G=["`+,^,+Y),`.,C,^`\\Yq^.1e31H,01.,C,^`\\Yq","T$$T,+)$),Y))<$TTYTl.).1^..D,\\.,<$TTTTT`","GNKNGNKNLSOSLSOSKSNSKSNSLSNSL@BCESOSESOSCOCOCOCOBNBN?J?J@CGL@@@@"],I=["xtvstqpsxtvs\\`}|x","tqspqqpptqspY`xx","LSOSLSOSKSNSKSNSLSOSLSOSKSNSKSNS"],U=[],J=[],$=[],R=10,j=22,D=R*j+20,F="08080890dd936f9e809dd090e09c0c9f22".split(9),H=atob("8ABERAAPIiJxACYCcAQiA3QAIgZwASMCZgBmAGYAZgA2AGIEYAMxAnIAYgJwAjICYwBkAjAGMgE"),Z="203(C214A,241<!230#8",z='219"!23+BC23;"#21)BA',Q=[],P=0,V=0,W=0,X=1,_=2,et=[],tt='<div style="margin:',it="</div>",rt=";box-shadow:",ot=tt+"-14pc -10pc;position:fixed;width:20pc;left:50%;top:50%;font:12px Arial;background:rgba(0,0,0,.8)"+rt+'0 0 2pc #000;border-radius:1pc">'+tt+'1pc 2pc;color:#888"><b><a href="http://github.com/ttencate/tis" style="color:inherit">Tis</a></b>: Tetris in 4 kB of JavaScript<br><br>Left/right: move | Up/Ctrl/Alt: rotate | Esc: quit<br>Down/space: soft/hard drop | M: music'+it+tt+'0 1pc;float:right;color:#eee;font-size:1pc"><div id="tis-status">'+it+"Next"+tt+"8px 0;width:4pc;height:2pc"+rt+'0 0 9px #000">';for(f=tt+"0;width:1pc;height:1pc;float:left"+rt+'-2px -2px 8px rgba(0,0,0,.4) inset,0 0 2px #000 inset" id="tis-',L=220;D>L;L++)4>L%R&&(ot+=f+L+'">'+it);for(ot+=it+it+tt+"0 2pc 2pc;background:#000;width:10pc;height:20pc"+rt+'0 0 9px #222">',L=0;D>L;L++)J.push(0),L>19&&220>L&&(ot+=f+L+'">'+it);ot+=it+it,N=e[q]("div"),N.innerHTML=ot,e.body.appendChild(ot=N),N=new Uint8Array(881856),I[2]+=I[2];for(b in G)for(G[b]+=G[b]+I[b],L=0,y=0;y<G[b].length;)for(O=G[b][i](y++)-(2==b?64:32),m=.00499*M.pow(2,(O%24+(2==b?0:27))/12),f=[15,9,9][b],T=0;T<4593*[1,3,2,4][~~(O/24)];)N[L++]=(N[L]||127)+(T++*m%2<1?f:-f),f*=.9999;G=p(N),G.play(),G.loop=1,d(0),e[t](o,u),e[t](K,l)}()})}();