!function(){var t,e,i,o,a,r,s,d,n,f,p,h,c,x,l,u,S,v=document,b="getElementById",g="addEventListener",y=["`+,^,+Y),`.,C,^`\\Yq^.1e31H,01.,C,^`\\Yq","T$$T,+)$),Y))<$TTYTl.).1^..D,\\.,<$TTTTT`","GNKNGNKNLSOSLSOSKSNSKSNSLSNSL@BCESOSESOSCOCOCOCOBNBN?J?J@CGL@@@@"],w=["xtvstqpsxtvs\\`}|x","tqspqqpptqspY`xx","LSOSLSOSKSNSKSNSLSOSLSOSKSNSKSNS"],L=[],k=[],C=10,m=22,N=C*m+20,O="080808 0dd 36f e80 dd0 0e0 c0c f22".split(" "),M=[,[240,17476,3840,8738],[113,550,1136,802],[116,1570,368,547],[102,102,102,102],[54,1122,864,561],[114,610,624,562],[99,612,1584,306]],T="203(C214A,241<!230#8",q='219"!23+BC23;"#21)BA',K=.15,B=0,A=0,Y=0,E=1,$=0,D=[],G=[],H='<div id="tis-root" style="position:fixed;width:280px;height:400px;left:50%;top:50%;margin:-240px -160px;background:rgba(0,0,0,0.8);box-shadow:0 0 30px #000;border-radius:30px;padding:40px"><div id="tis-grid" style="background:#000;width:200px;height:400px;box-shadow:0 0 9px #222;">';v[g]("DOMContentLoaded",function(){function I(e,i,o,a){return t&&(3&e)==e&&(3&i)==i&&M[a||t][o]&1<<4*i+e}function U(){for(x=i;t&&J(e,i+1,o,1););for(c=0;m+4>c;c++)for(h=0;C>h;h++)f=c*C+h,c>=m&&(L[f]=I(h,c-m,0,D[0])?D[0]:0),k[f]=I(h-e,c-x,o)?t:I(h-e,c-i,o)?t+8:L[f]||0,(u=v[b]("tis-"+f))&&(u.style.background="#"+(1==B&&2>a%4&&r[c]?"fff":O[k[f]%8]),u.style.opacity=k[f]>7?.2:1);i=x,x='<div style="text-align:right;font-size:150%">',v[b]("tis-status").innerHTML="Score"+x+A+"</div>Lines"+x+Y+"</div>Level"+x+E+"</div>"}function J(t,a,r,s){for(c=a;a+4>c;c++)for(h=t;t+4>h;h++)if(I(h-t,c-a,r)&&(0>h||h>=C||0>c||c>=m||L[c*C+h]))return 0;return e=t,i=a,o=r,$=0,s||U(),1}function R(u){switch(d=(u-n)/1e3||0,d>.1&&(d=.1),n=u,B){case 2:if(a-->4&&!(a%4)){for(h=0;C>h;h++)L[a*C/4+h]=1+Math.floor(7*Math.random());U()}break;case 1:if(--a<0){for(c in r)for(f=c*C+C-1;f>=0;f--)L[f]=L[f-C];B=0}U();break;case 0:S=1;for(l in G){switch(parseInt(l)){case 37:if(G[l]<0)break;G[l]-=K,J(e-1,i,o);break;case 39:if(G[l]<0)break;G[l]-=K,J(e+1,i,o);break;case 38:if(G[l])break;for(;J(e,i+1,o););$=9;break;case 90:case 186:S=-1;case 88:case 81:if(!G[l])for(f=0;5>f&&(x=(1==t?T:q).charCodeAt((o+4+(S-1)/2)%4*5+f)-32,!J(e+S*((7&x)-2),i+S*(2-(x>>3)),(o+4+S)%4));f++);}G[l]+=d}if(s+=Math.max(G[40]?.2:0,d*(E+1)/1.5),s>1&&(s=0,J(e,i+1,o)),!t||$>1){for(U(),f=0;N>f;f++)L[f]=k[f];for(l=0,r=[],c=0;m>c;c++){for(x=1,h=0;C>h;h++)if(!L[c*C+h]){x=0;break}x&&(r[c]=1,l++,B=1,a=6)}if(A+=[0,100,300,500,800][l]*E,Y+=l,E=1+Math.floor(Y/10),D.length<2)for(x=1,f=0;7>f;f++){for(p=0;x&1<<p;)p=Math.ceil(7*Math.random());x|=1<<p,D.push(p)}t=D.shift(),s=0,J(3,0,0)||(B=2,a=4*m),U()}$+=d}window.requestAnimationFrame(R)}function j(t){x=t.keyCode,77==x&&(x=v[b]("tis-music"),x.paused?x.play():x.pause()),G[x]||(G[x]=0),(x>36&&41>x||88==x||88==x||90==x||186==x)&&t.preventDefault()}function z(t){delete G[t.keyCode]}w[2]+=w[2];for(f in y)y[f]+=y[f]+w[f];for(l='" style="width:20px;height:20px;float:left;box-shadow:-2px -2px 8px rgba(0,0,0,0.4) inset, 0 0 2px #000 inset;"></div>',f=0;N>f;f++)L.push(0),f>19&&220>f&&(H+='<div id="tis-'+f+l);for(H+='</div><div style="position:absolute;right:20px;top:40px;width:80px;color:#eee;font:normal 15px sans-serif"><div id="tis-status"></div>Next<div style="margin:8px 0;height:40px;box-shadow:0 0 9px #000;">',f=220;N>f;f++)4>f%C&&(H+='<div id="tis-'+f+l);for(H+="</div></div></div>",l=881856,x=new Uint8Array(l+44),x.set([82,73,70,70,l+36&255,l+36>>8&255,l+36>>16,0,87,65,86,69,102,109,116,32,16,0,0,0,1,0,1,0,34,86,0,0,34,86,0,0,1,0,8,0,100,97,116,97,255&l,l>>8&255,l>>16,0]),d=0;3>d;d++)for(f=44,p=0;p<y[d].length;p++)for(u=y[d].charCodeAt(p)-(2==d?64:32),h=2*Math.PI*(2==d?55:261.63)*Math.pow(2,u%24/12)/22050,l=[.2,.1,.1][d],c=0;c<4593*[1,3,2,4][Math.floor(u/24)];c++)x[f++]+=127*(!d+l*(Math.sin(c*h)>0?1:-1)),l*=.9999;H+='<audio id="tis-music" src="'+URL.createObjectURL(new Blob([x],{type:"audio/wav"}))+'" loop'+("#m"==location.hash?"":" autoplay")+"></audio>",x=v.createElement("div"),x.innerHTML=H,v.body.appendChild(x),R(0),v[g]("keydown",j),v[g]("keyup",z)})}();