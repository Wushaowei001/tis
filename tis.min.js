!function(){var t=document,e="addEventListener",i="charCodeAt",o="keyCode",r="keydown",n=0,f=27;t[e](r,function(p){n=p[o]=="&&((%'%'BA"[i](n)?n+1:0,27==f&&n>9&&!function(){function n(t){return N=t.length,new Audio(URL.createObjectURL(new Blob(["RIFF",new Uint32Array([N+36,1163280727,544501094,16,65537,22050,22050,524289,1635017060,N]),t],{type:"audio/wav"})))}function p(t,e,o,r){return c&&!(-4&t)&&!(-4&e)&&D[i](8*(r||c)-8+2*o+(e>>1))&1<<4*(1&e)+t}function a(){for(N=l;c&&s(S,l+1,h,1););for(m=0;$+4>m;m++)for(y=0;J>y;y++)v=m*J+y,m>=$&&(I[v]=p(y,m-$,0,Z[0])?Z[0]:0),U[v]=p(y-S,m-N,h)?c:p(y-S,m-l,h)?c+8:I[v]||0,(O=B["tis-"+v])&&(O=O.style,O.background="#"+(1==z&&2>A%4&&g[m]?"fff":j[U[v]%8]),O.opacity=U[v]>7?.2:1);l=N,N=_+'0;text-align:right;font-size:150%">',B["tis-status"].innerHTML="Score"+N+Q+te+"Lines"+N+P+te+"Level"+N+V+te}function s(t,e,i,o){for(L=0;y=3&L,m=L>>2,16>L;L++)if(p(y,m,i)&&((y+=t)<0||y>=J||(m+=e)<0||m>=$||I[m*J+y]))return;return S=t,l=e,h=i,W=0,o||a(),1}function d(e){if(b=(e-C)/1e3||0,b>.1&&(b=.1),C=e,2==z){if(A-->4&&!(A%4)){for(y=0;J>y;)I[A*J/4+y++]=1+~~(7*E.random());a()}}else if(1==z){if(--A<0){for(m in g)for(v=m*J+J-1;v>=0;v--)I[v]=I[v-J];z=0}a()}else{for(f in X){if(27==f)return t.body.removeChild(ie),t[k](r,x),t[k](q,u),void K.pause();if((37==f||39==f)&&X[f]>=0&&(X[f]-=X[f]?.05:.2,s(S+1-2*(37==f),l,h)),32==f&&!X[f]){for(;s(S,l+1,h););W=9}if((38==f||18==f||17==f)&&(T=1-2*(17==f),!X[f]))for(v=0;5>v;)if(N=(1==c?F:H)[i]((h+4+(T-1)/2)%4*5+v++)-32,s(S+T*((7&N)-2),l+T*(2-(N>>3)),(h+4+T)%4)){G[0]();break}X[f]+=b}if(w+=E.max(X[40]?.2:0,b*E.pow(1.23,V)),w>1&&(w=0,s(S,l+1,h)),W>1){c&&G[1]();for(v in I)I[v]=U[v];f=0,g=[];t:for(m=0;$>m;m++){for(y=0;J>y;)if(!I[m*J+y++])continue t;g[m]=z=1,f++,A=6}if(f&&G[1+f](),Q+=100*[0,1,3,5,8][f]*V,P+=f,V=1+~~(P/10),Z.length<2)for(N=1;255!=N;){for(L=0;N&1<<L;L=1+~~(7*E.random()));N|=1<<L,Z.push(L)}c=Z.shift(),w=0,s(3,0,0)||(c=0,z=2,A=4*$,G[6]())}W+=b}requestAnimationFrame(d)}function x(t){N=t[o],77==N&&K[K.paused?"play":"pause"](),X[N]=X[N]||0,[17,18,27,37,38,39,40,77].indexOf(N)>=0&&t.preventDefault()}function u(t){delete X[t[o]]}var c,S,l,h,A,g,b,w,C,v,L,y,m,N,O,T,B=window,Y="createElement",k="removeEventListener",q="keyup",E=Math,K=["`+,^,+Y),`.,C,^`\\Yq^.1e31H,01.,C,^`\\Yq","T$$T,+)$),Y))<$TTYTl.).1^..D,\\.,<$TTTTT`","GNKNGNKNLSOSLSOSKSNSKSNSLSNSL@BCESOSESOSCOCOCOCOBNBN?J?J@CGL@@@@"],M=["xtvstqpsxtvs\\`}|x","tqspqqpptqspY`xx","LSOSLSOSKSNSKSNSLSOSLSOSKSNSKSNS"],G=[8303,31445,8392,8260,8242,8225,31360],I=[],U=[],J=10,$=22,R=J*$+20,j="08080890dd936f9e809dd090e09c0c9f22".split(9),D=atob("8ABERAAPIiJxACYCcAQiA3QAIgZwASMCZgBmAGYAZgA2AGIEYAMxAnIAYgJwAjICYwBkAjAGMgE"),F="203(C214A,241<!230#8",H='219"!23+BC23;"#21)BA',Z=[],z=0,Q=0,P=0,V=1,W=2,X=[],_='<div style="margin:',te="</div>",ee=";box-shadow:",ie=_+"-270px -180px;position:fixed;width:360px;left:50%;top:50%;font:13px sans-serif;background:rgba(0,0,0,.8)"+ee+'0 0 30px #000;border-radius:30px">'+_+'20px 40px;color:#888"><b><a href="http://github.com/ttencate/tis" style="color:inherit">Tis</a></b>: Tetris in 4 kB of JavaScript<br><br>Left/right: move | Up/Ctrl/Alt: rotate | Esc: quit<br>Down/space: soft/hard drop | M: music'+te+_+'0 20px;float:right;width:80px;color:#eee;font-size:15px"><div id="tis-status">'+te+"Next"+_+"8px 0;height:40px"+ee+'0 0 9px #000">';for(f=_+"0;width:20px;height:20px;float:left"+ee+'-2px -2px 8px rgba(0,0,0,.4) inset,0 0 2px #000 inset" id="tis-',v=220;R>v;v++)4>v%J&&(ie+=f+v+'">'+te);for(ie+=te+te+_+"0 40px 40px;background:#000;width:200px;height:400px"+ee+'0 0 9px #222">',v=0;R>v;v++)I.push(0),v>19&&220>v&&(ie+=f+v+'">'+te);ie+=te+te,N=t[Y]("div"),N.innerHTML=ie,t.body.appendChild(ie=N),N=new Uint8Array(881856),M[2]+=M[2];for(b in K)for(K[b]+=K[b]+M[b],v=0,L=0;L<K[b].length;)for(O=K[b][i](L++)-(2==b?64:32),y=.00499*E.pow(2,(O%24+(2==b?0:27))/12),f=[15,9,9][b],m=0;m<4593*[1,3,2,4][~~(O/24)];)N[v++]=(N[v]||127)+(m++*y%2<1?f:-f),f*=.9999;K=n(N,1),K.play(),K.loop=1;for(v in G){T=G[v],N=new Uint8Array(9e3),f=50,O=T>>10;for(L in N)L>1e3&&(O=T>>4&63),N[L]=127+(f*=1-1e-4*(15&T))*(O/2>L/10%O?-1:1);N=n(N),G[v]=N.play.bind(N)}d(0),t[e](r,x),t[e](q,u)}()})}();