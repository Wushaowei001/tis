!function(){var t,e,i,o,a,r,d,s,n,f,p,c,h,x,l,u=document,S="getElementById",v="addEventListener",b=["`+,^,+Y),`.,C,^`\\Yq^.1e31H,01.,C,^`\\Yq","T$$T,+)$),Y))<$TTYTl.).1^..D,\\.,<$TTTTT`","GNKNGNKNLSOSLSOSKSNSKSNSLSNSL@BCESOSESOSCOCOCOCOBNBN?J?J@CGL@@@@"],g=["xtvstqpsxtvs\\`}|x","tqspqqpptqspY`xx","LSOSLSOSKSNSKSNSLSOSLSOSKSNSKSNS"],w=[],y=[],L=10,k=22,m=L*k+20,N="080808 0dd 36f e80 dd0 0e0 c0c f22 002c2c 0a1433 301b00 2c2c00 003000 290029 330707".split(" "),O=[,[240,17476,3840,8738],[113,550,1136,802],[116,1570,368,547],[102,102,102,102],[54,1122,864,561],[114,610,624,562],[99,612,1584,306]],C=.15,M=0,T=0,q=0,K=1,Y=0,B=[],E=[],$='<div id="tis-root" style="position:fixed;width:280px;height:400px;left:50%;top:50%;margin:-240px -160px;background:rgba(0,0,0,0.8);box-shadow:0 0 30px #000;border-radius:30px;padding:40px"><div id="tis-grid" style="background:#000;width:200px;height:400px;box-shadow:0 0 9px #222;">';u[v]("DOMContentLoaded",function(){function A(e,i,o,a){return t&&(3&e)==e&&(3&i)==i&&O[a||t][o]&1<<4*i+e}function D(){for(h=i;t&&!G(e,h+1,o);h++);for(c=0;k+4>c;c++)for(p=0;L>p;p++)n=c*L+p,c>=k&&(w[n]=A(p,c-k,0,B[0])?B[0]:0),y[n]=A(p-e,c-i,o)?t:A(p-e,c-h,o)?t+7:w[n]||0,(l=u[S]("tis-"+n))&&(l.style.background="#"+N[y[n]]);h='<div style="text-align:right;font-size:150%">',u[S]("tis-status").innerHTML="Score"+h+T+"</div>Lines"+h+q+"</div>Level"+h+K+"</div>"}function G(t,e,i){for(c=e;e+4>c;c++)for(p=t;t+4>p;p++)if(A(p-t,c-e,i)&&(0>p||p>=L||0>c||c>=k||w[c*L+p]))return 1;return 0}function H(l){switch(d=(l-s)/1e3||0,s=l,M){case 1:if(a>1){for(p=0;L>p;p++)w[a*L+p]=1+Math.floor(7*Math.random());D(),a--}break;case 0:for(x in E){switch(parseInt(x)){case 37:if(E[x]<0)break;E[x]-=C,G(e-1,i,o)||(e--,Y=0,D());break;case 39:if(E[x]<0)break;E[x]-=C,G(e+1,i,o)||(e++,Y=0,D());break;case 38:if(E[x])break;for(;!G(e,i+1,o);)i++;Y=9;break;case 90:case 186:E[x]||G(e,i,(o+3)%4)||(o=(o+3)%4,Y=0,D());break;case 88:case 81:E[x]||G(e,i,(o+1)%4)||(o=(o+1)%4,Y=0,D())}E[x]+=d}if(r+=Math.max(E[40]?.2:0,d*(K+1)/1.5),r>1&&(r=0,G(e,i+1,o)||(i++,Y=0,D())),!t||Y>1&&G(e,i+1,o)){for(D(),n=0;m>n;n++)w[n]=y[n];for(x=0,c=0;k>c;c++){for(h=1,p=0;L>p;p++)if(!w[c*L+p]){h=0;break}if(h)for(x++,n=c*L+L-1;n>=0;n--)w[n]=w[n-L]}if(T+=[0,100,300,500,800][x]*K,q+=x,K=1+Math.floor(q/10),B.length<2)for(h=1,n=0;7>n;n++){for(f=0;h&1<<f;)f=Math.ceil(7*Math.random());h|=1<<f,B.push(f)}t=B.shift(),e=3,i=0,o=0,r=0,Y=0,G(e,i,o)&&(M=1,a=k),D()}Y+=d}window.requestAnimationFrame(H)}function I(t){h=t.keyCode,77==h&&(h=u[S]("tis-music"),h.paused?h.play():h.pause()),E[h]||(E[h]=0),(h>36&&41>h||88==h||88==h||90==h||186==h)&&t.preventDefault()}function U(t){delete E[t.keyCode]}g[2]+=g[2];for(n in b)b[n]+=b[n]+g[n];for(x='" style="width:20px;height:20px;float:left;box-shadow:-2px -2px 8px rgba(0,0,0,0.4) inset, 0 0 2px #000 inset;"></div>',n=0;m>n;n++)w.push(0),n>19&&220>n&&($+='<div id="tis-'+n+x);for($+='</div><div style="position:absolute;right:20px;top:40px;width:80px;color:#eee;font:normal 15px sans-serif"><div id="tis-status"></div>Next<div style="margin:8px 0;height:40px;box-shadow:0 0 9px #000;">',n=220;m>n;n++)4>n%L&&($+='<div id="tis-'+n+x);for($+="</div></div></div>",x=881856,h=new Uint8Array(x+44),h.set([82,73,70,70,x+36&255,x+36>>8&255,x+36>>16,0,87,65,86,69,102,109,116,32,16,0,0,0,1,0,1,0,34,86,0,0,34,86,0,0,1,0,8,0,100,97,116,97,255&x,x>>8&255,x>>16,0]),d=0;3>d;d++)for(n=44,f=0;f<b[d].length;f++)for(l=b[d].charCodeAt(f)-(2==d?64:32),p=2*Math.PI*(2==d?55:261.63)*Math.pow(2,l%24/12)/22050,x=[.2,.1,.1][d],c=0;c<4593*[1,3,2,4][Math.floor(l/24)];c++)h[n++]+=127*(!d+x*(Math.sin(c*p)>0?1:-1)),x*=.9999;$+='<audio id="tis-music" src="'+URL.createObjectURL(new Blob([h],{type:"audio/wav"}))+'" loop'+("#m"==location.hash?"":" autoplay")+"></audio>",h=u.createElement("div"),h.innerHTML=$,u.body.appendChild(h),H(0),u[v]("keydown",I),u[v]("keyup",U)})}();