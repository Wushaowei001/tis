!function(){var t,e,i,o,a,r,d,s,n,f,p,h,c,x,l,u,S=document,v="getElementById",b="addEventListener",g=["`+,^,+Y),`.,C,^`\\Yq^.1e31H,01.,C,^`\\Yq","T$$T,+)$),Y))<$TTYTl.).1^..D,\\.,<$TTTTT`","GNKNGNKNLSOSLSOSKSNSKSNSLSNSL@BCESOSESOSCOCOCOCOBNBN?J?J@CGL@@@@"],y=["xtvstqpsxtvs\\`}|x","tqspqqpptqspY`xx","LSOSLSOSKSNSKSNSLSOSLSOSKSNSKSNS"],w=[],L=[],C=10,k=22,m=C*k+20,N="080808 0dd 36f e80 dd0 0e0 c0c f22".split(" "),O=[,[240,17476,3840,8738],[113,550,1136,802],[116,1570,368,547],[102,102,102,102],[54,1122,864,561],[114,610,624,562],[99,612,1584,306]],M="203(C214A,241<!230#8",T='219"!23+BC23;"#21)BA',q=.15,K=0,B=0,A=0,Y=1,E=0,$=[],D=[],G='<div id="tis-root" style="position:fixed;width:280px;height:400px;left:50%;top:50%;margin:-240px -160px;background:rgba(0,0,0,0.8);box-shadow:0 0 30px #000;border-radius:30px;padding:40px"><div id="tis-grid" style="background:#000;width:200px;height:400px;box-shadow:0 0 9px #222;">';S[b]("DOMContentLoaded",function(){function H(e,i,o,a){return t&&(3&e)==e&&(3&i)==i&&O[a||t][o]&1<<4*i+e}function I(){for(c=i;t&&U(e,i+1,o,1););for(h=0;k+4>h;h++)for(p=0;C>p;p++)n=h*C+p,h>=k&&(w[n]=H(p,h-k,0,$[0])?$[0]:0),L[n]=H(p-e,h-c,o)?t:H(p-e,h-i,o)?t+8:w[n]||0,(l=S[v]("tis-"+n))&&(l.style.background="#"+N[L[n]%8],l.style.opacity=L[n]>7?.2:1);i=c,c='<div style="text-align:right;font-size:150%">',S[v]("tis-status").innerHTML="Score"+c+B+"</div>Lines"+c+A+"</div>Level"+c+Y+"</div>"}function U(t,a,r,d){for(h=a;a+4>h;h++)for(p=t;t+4>p;p++)if(H(p-t,h-a,r)&&(0>p||p>=C||0>h||h>=k||w[h*C+p]))return 0;return e=t,i=a,o=r,E=0,d||I(),1}function J(l){switch(d=(l-s)/1e3||0,d>.1&&(d=.1),s=l,K){case 1:if(a>1){for(p=0;C>p;p++)w[a*C+p]=1+Math.floor(7*Math.random());I(),a--}break;case 0:u=1;for(x in D){switch(parseInt(x)){case 37:if(D[x]<0)break;D[x]-=q,U(e-1,i,o);break;case 39:if(D[x]<0)break;D[x]-=q,U(e+1,i,o);break;case 38:if(D[x])break;for(;U(e,i+1,o););E=9;break;case 90:case 186:u=-1;case 88:case 81:if(!D[x])for(n=0;5>n&&(c=(1==t?M:T).charCodeAt((o+4+(u-1)/2)%4*5+n)-32,!U(e+u*((7&c)-2),i+u*(2-(c>>3)),(o+4+u)%4));n++);}D[x]+=d}if(r+=Math.max(D[40]?.2:0,d*(Y+1)/1.5),r>1&&(r=0,U(e,i+1,o)),!t||E>1){for(I(),n=0;m>n;n++)w[n]=L[n];for(x=0,h=0;k>h;h++){for(c=1,p=0;C>p;p++)if(!w[h*C+p]){c=0;break}if(c)for(x++,n=h*C+C-1;n>=0;n--)w[n]=w[n-C]}if(B+=[0,100,300,500,800][x]*Y,A+=x,Y=1+Math.floor(A/10),$.length<2)for(c=1,n=0;7>n;n++){for(f=0;c&1<<f;)f=Math.ceil(7*Math.random());c|=1<<f,$.push(f)}t=$.shift(),r=0,U(3,0,0)||(K=1,a=k),I()}E+=d}window.requestAnimationFrame(J)}function R(t){c=t.keyCode,77==c&&(c=S[v]("tis-music"),c.paused?c.play():c.pause()),D[c]||(D[c]=0),(c>36&&41>c||88==c||88==c||90==c||186==c)&&t.preventDefault()}function j(t){delete D[t.keyCode]}y[2]+=y[2];for(n in g)g[n]+=g[n]+y[n];for(x='" style="width:20px;height:20px;float:left;box-shadow:-2px -2px 8px rgba(0,0,0,0.4) inset, 0 0 2px #000 inset;"></div>',n=0;m>n;n++)w.push(0),n>19&&220>n&&(G+='<div id="tis-'+n+x);for(G+='</div><div style="position:absolute;right:20px;top:40px;width:80px;color:#eee;font:normal 15px sans-serif"><div id="tis-status"></div>Next<div style="margin:8px 0;height:40px;box-shadow:0 0 9px #000;">',n=220;m>n;n++)4>n%C&&(G+='<div id="tis-'+n+x);for(G+="</div></div></div>",x=881856,c=new Uint8Array(x+44),c.set([82,73,70,70,x+36&255,x+36>>8&255,x+36>>16,0,87,65,86,69,102,109,116,32,16,0,0,0,1,0,1,0,34,86,0,0,34,86,0,0,1,0,8,0,100,97,116,97,255&x,x>>8&255,x>>16,0]),d=0;3>d;d++)for(n=44,f=0;f<g[d].length;f++)for(l=g[d].charCodeAt(f)-(2==d?64:32),p=2*Math.PI*(2==d?55:261.63)*Math.pow(2,l%24/12)/22050,x=[.2,.1,.1][d],h=0;h<4593*[1,3,2,4][Math.floor(l/24)];h++)c[n++]+=127*(!d+x*(Math.sin(h*p)>0?1:-1)),x*=.9999;G+='<audio id="tis-music" src="'+URL.createObjectURL(new Blob([c],{type:"audio/wav"}))+'" loop'+("#m"==location.hash?"":" autoplay")+"></audio>",c=S.createElement("div"),c.innerHTML=G,S.body.appendChild(c),J(0),S[b]("keydown",R),S[b]("keyup",j)})}();