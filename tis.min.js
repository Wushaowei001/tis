document.addEventListener("DOMContentLoaded",function(){function e(e,t,i,o){return r&&!(-4&e)&&!(-4&t)&&q.charCodeAt(8*(o||r)-8+2*i+(t>>1))&1<<4*(1&t)+e}function t(){for(b=n;r&&i(a,n+1,d,1););for(v=0;B+4>v;v++)for(S=0;T>S;S++)l=v*T+S,v>=B&&(N[l]=e(S,v-B,0,Z[0])?Z[0]:0),O[l]=e(S-a,v-b,d)?r:e(S-a,v-n,d)?r+8:N[l]||0,(g=w[m]("tis-"+l))&&(g=g.style,g.background="#"+(1==G&&2>s%4&&f[v]?"fff":E[O[l]%8]),g.opacity=O[l]>7?.2:1);n=b,b='<div style="text-align:right;font-size:150%">',w[m]("tis-status").innerHTML="Score"+b+J+"</div>Lines"+b+$+"</div>Level"+b+D+"</div>"}function i(i,o,r,s){for(h=0;S=3&h,v=h>>2,16>h;h++)if(e(S,v,r)&&((S+=i)<0||S>=T||(v+=o)<0||v>=B||N[v*T+S]))return 0;return a=i,n=o,d=r,U=0,s||t(),1}function o(e){switch(c=(e-x)/1e3||0,c>.1&&(c=.1),x=e,G){case 2:if(s-->4&&!(s%4)){for(S=0;T>S;S++)N[s*T/4+S]=1+C.floor(7*C.random());t()}break;case 1:if(--s<0){for(v in f)for(l=v*T+T-1;l>=0;l--)N[l]=N[l-T];G=0}t();break;case 0:A=1;for(u in j){switch(parseInt(u)){case 37:if(j[u]<0)break;j[u]-=M,i(a-1,n,d);break;case 39:if(j[u]<0)break;j[u]-=M,i(a+1,n,d);break;case 38:if(j[u])break;for(;i(a,n+1,d););U=9;break;case 90:case 186:A=-1;case 88:case 81:if(!j[u])for(l=0;5>l&&(b=(1==r?I:K).charCodeAt((d+4+(A-1)/2)%4*5+l)-32,!i(a+A*((7&b)-2),n+A*(2-(b>>3)),(d+4+A)%4));l++);}j[u]+=c}if(p+=C.max(j[40]?.2:0,c*C.pow(1.23,D)),p>1&&(p=0,i(a,n+1,d)),!r||U>1){t();for(l in N)N[l]=O[l];for(u=0,f=[],v=0;B>v;v++){for(b=1,S=0;T>S;S++)if(!N[v*T+S]){b=0;break}b&&(f[v]=1,u++,G=1,s=6)}if(J+=[0,100,300,500,800][u]*D,$+=u,D=1+C.floor($/10),Z.length<2)for(b=1;255!=b;){for(h=0;b&1<<h;h=C.ceil(7*C.random()));b|=1<<h,Z.push(h)}r=Z.shift(),p=0,i(3,0,0)||(G=2,s=4*B),t()}U+=c}window.requestAnimationFrame(o)}var r,a,n,d,s,f,p,c,x,l,h,S,v,b,u,g,A,w=document,C=Math,m="getElementById",y="addEventListener",L=["`+,^,+Y),`.,C,^`\\Yq^.1e31H,01.,C,^`\\Yq","T$$T,+)$),Y))<$TTYTl.).1^..D,\\.,<$TTTTT`","GNKNGNKNLSOSLSOSKSNSKSNSLSNSL@BCESOSESOSCOCOCOCOBNBN?J?J@CGL@@@@"],k=["xtvstqpsxtvs\\`}|x","tqspqqpptqspY`xx","LSOSLSOSKSNSKSNSLSOSLSOSKSNSKSNS"],N=[],O=[],T=10,B=22,Y=T*B+20,E="080808 0dd 36f e80 dd0 0e0 c0c f22".split(" "),q=atob("8ABERAAPIiJxACYCcAQiA3QAIgZwASMCZgBmAGYAZgA2AGIEYAMxAnIAYgJwAjICYwBkAjAGMgE"),I="203(C214A,241<!230#8",K='219"!23+BC23;"#21)BA',M=.15,G=0,J=0,$=0,D=1,U=0,Z=[],j=[],H='<div style="position:fixed;width:360px;left:50%;top:50%;margin:-270px -180px;background:rgba(0,0,0,0.8);box-shadow:0 0 30px #000;border-radius:30px"><div style="margin:20px 40px;font-size:80%;color:#888"><b><a href="http://github.com/ttencate/tis" style="color:inherit">Tis</a></b>: 4 kB of JavaScript<br><br>Left/right: move | Z/X: rotate<br>Down: soft drop | Up: hard drop | M: music</div><div style="float:right;margin:0 20px;width:80px;color:#eee;font:15px sans-serif"><div id="tis-status"></div>Next<div style="margin:8px 0;height:40px;box-shadow:0 0 9px #000;">';for(u='" style="width:20px;height:20px;float:left;box-shadow:-2px -2px 8px rgba(0,0,0,0.4) inset, 0 0 2px #000 inset;"></div>',l=220;Y>l;l++)4>l%T&&(H+='<div id="tis-'+l+u);for(H+='</div></div><div style="background:#000;width:200px;height:400px;box-shadow:0 0 9px #222;margin:0 40px 40px">',l=0;Y>l;l++)N.push(0),l>19&&220>l&&(H+='<div id="tis-'+l+u);H+="</div></div>",b=w.createElement("div"),b.innerHTML=H,w.body.appendChild(b),u=881856,b=new Uint8Array(u+44),b.set([82,73,70,70,u+36&255,u+36>>8&255,u+36>>16,0,87,65,86,69,102,109,116,32,16,0,0,0,1,0,1,0,34,86,0,0,34,86,0,0,1,0,8,0,100,97,116,97,255&u,u>>8&255,u>>16,0]),k[2]+=k[2];for(c in L)for(L[c]+=L[c]+k[c],l=44,h=0;h<L[c].length;h++)for(g=L[c].charCodeAt(h)-(2==c?64:32),S=2*C.PI*(2==c?55:261.63)*C.pow(2,g%24/12)/22050,u=[.2,.1,.1][c],v=0;v<4593*[1,3,2,4][C.floor(g/24)];v++)b[l++]+=127*((0==c)+u*(C.sin(v*S)>0?1:-1)),u*=.9999;L=w.createElement("audio"),L.src=URL.createObjectURL(new Blob([b],{type:"audio/wav"})),L.loop=1,"#m"!=location.hash&&L.play(),o(0),w[y]("keydown",function(e){b=e.keyCode,77==b&&(L.paused?L.play():L.pause()),j[b]||(j[b]=0),(b>36&&41>b||88==b||88==b||90==b||186==b)&&e.preventDefault()}),w[y]("keyup",function(e){delete j[e.keyCode]})});