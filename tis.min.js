document.addEventListener("DOMContentLoaded",function(){function e(e,t,i,o){return a&&!(-4&e)&&!(-4&t)&&B.charCodeAt(8*(o||a)-8+2*i+(t>>1))&1<<4*(1&t)+e}function t(){for(v=n;a&&i(r,n+1,d,1););for(u=0;O+4>u;u++)for(S=0;N>S;S++)x=u*N+S,u>=O&&(M[x]=e(S,u-O,0,D[0])?D[0]:0),m[x]=e(S-r,u-v,d)?a:e(S-r,u-n,d)?a+8:M[x]||0,(b=C[w]("tis-"+x))&&(b=b.style,b.background="#"+(1==K&&2>s%4&&f[u]?"fff":Y[m[x]%8]),b.opacity=m[x]>7?.2:1);n=v,v='<div style="text-align:right;font-size:150%">',C[w]("tis-status").innerHTML="Score"+v+G+"</div>Lines"+v+$+"</div>Level"+v+J+"</div>"}function i(i,o,a,s){for(l=0;S=3&l,u=l>>2,16>l;l++)if(e(S,u,a)&&((S+=i)<0||S>=N||(u+=o)<0||u>=O||M[u*N+S]))return 0;return r=i,n=o,d=a,j=0,s||t(),1}function o(e){switch(h=(e-c)/1e3||0,h>.1&&(h=.1),c=e,K){case 2:if(s-->4&&!(s%4)){for(S=0;N>S;S++)M[s*N/4+S]=1+Math.floor(7*Math.random());t()}break;case 1:if(--s<0){for(u in f)for(x=u*N+N-1;x>=0;x--)M[x]=M[x-N];K=0}t();break;case 0:g=1;for(A in H){switch(parseInt(A)){case 37:if(H[A]<0)break;H[A]-=I,i(r-1,n,d);break;case 39:if(H[A]<0)break;H[A]-=I,i(r+1,n,d);break;case 38:if(H[A])break;for(;i(r,n+1,d););j=9;break;case 90:case 186:g=-1;case 88:case 81:if(!H[A])for(x=0;5>x&&(v=(1==a?E:q).charCodeAt((d+4+(g-1)/2)%4*5+x)-32,!i(r+g*((7&v)-2),n+g*(2-(v>>3)),(d+4+g)%4));x++);}H[A]+=h}if(p+=Math.max(H[40]?.2:0,h*(J+1)/1.5),p>1&&(p=0,i(r,n+1,d)),!a||j>1){t();for(x in M)M[x]=m[x];for(A=0,f=[],u=0;O>u;u++){for(v=1,S=0;N>S;S++)if(!M[u*N+S]){v=0;break}v&&(f[u]=1,A++,K=1,s=6)}if(G+=[0,100,300,500,800][A]*J,$+=A,J=1+Math.floor($/10),D.length<2)for(v=1;255!=v;){for(l=0;v&1<<l;l=Math.ceil(7*Math.random()));v|=1<<l,D.push(l)}a=D.shift(),p=0,i(3,0,0)||(K=2,s=4*O),t()}j+=h}window.requestAnimationFrame(o)}var a,r,n,d,s,f,p,h,c,x,l,S,u,v,A,b,g,C=document,w="getElementById",y="addEventListener",L=["`+,^,+Y),`.,C,^`\\Yq^.1e31H,01.,C,^`\\Yq","T$$T,+)$),Y))<$TTYTl.).1^..D,\\.,<$TTTTT`","GNKNGNKNLSOSLSOSKSNSKSNSLSNSL@BCESOSESOSCOCOCOCOBNBN?J?J@CGL@@@@"],k=["xtvstqpsxtvs\\`}|x","tqspqqpptqspY`xx","LSOSLSOSKSNSKSNSLSOSLSOSKSNSKSNS"],M=[],m=[],N=10,O=22,T=N*O+20,Y="080808 0dd 36f e80 dd0 0e0 c0c f22".split(" "),B=atob("8ABERAAPIiJxACYCcAQiA3QAIgZwASMCZgBmAGYAZgA2AGIEYAMxAnIAYgJwAjICYwBkAjAGMgE"),E="203(C214A,241<!230#8",q='219"!23+BC23;"#21)BA',I=.15,K=0,G=0,$=0,J=1,j=0,D=[],H=[],R='<div style="position:fixed;width:280px;height:400px;left:50%;top:50%;margin:-240px -160px;background:rgba(0,0,0,0.8);box-shadow:0 0 30px #000;border-radius:30px;padding:40px"><div style="background:#000;width:200px;height:400px;box-shadow:0 0 9px #222;">';for(A='" style="width:20px;height:20px;float:left;box-shadow:-2px -2px 8px rgba(0,0,0,0.4) inset, 0 0 2px #000 inset;"></div>',x=0;T>x;x++)M.push(0),x>19&&220>x&&(R+='<div id="tis-'+x+A);for(R+='</div><div style="position:absolute;right:20px;top:40px;width:80px;color:#eee;font:normal 15px sans-serif"><div id="tis-status"></div>Next<div style="margin:8px 0;height:40px;box-shadow:0 0 9px #000;">',x=220;T>x;x++)4>x%N&&(R+='<div id="tis-'+x+A);R+="</div></div></div>",A=881856,v=new Uint8Array(A+44),v.set([82,73,70,70,A+36&255,A+36>>8&255,A+36>>16,0,87,65,86,69,102,109,116,32,16,0,0,0,1,0,1,0,34,86,0,0,34,86,0,0,1,0,8,0,100,97,116,97,255&A,A>>8&255,A>>16,0]),k[2]+=k[2];for(h in L)for(L[h]+=L[h]+k[h],x=44,l=0;l<L[h].length;l++)for(b=L[h].charCodeAt(l)-(2==h?64:32),S=2*Math.PI*(2==h?55:261.63)*Math.pow(2,b%24/12)/22050,A=[.2,.1,.1][h],u=0;u<4593*[1,3,2,4][Math.floor(b/24)];u++)v[x++]+=127*(!h+A*(Math.sin(u*S)>0?1:-1)),A*=.9999;L=C.createElement("audio"),L.src=URL.createObjectURL(new Blob([v],{type:"audio/wav"})),L.loop=1,L.autoplay="#m"==location.hash,v=C.createElement("div"),v.innerHTML=R,C.body.appendChild(v),o(0),C[y]("keydown",function(e){v=e.keyCode,77==v&&(L.paused?L.play():L.pause()),H[v]||(H[v]=0),(v>36&&41>v||88==v||88==v||90==v||186==v)&&e.preventDefault()}),C[y]("keyup",function(e){delete H[e.keyCode]})});