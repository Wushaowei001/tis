document.addEventListener("DOMContentLoaded",function(){function t(t,e,i,o){return d&&!(-4&t)&&!(-4&e)&&q.charCodeAt(8*(o||d)-8+2*i+(e>>1))&1<<4*(1&e)+t}function e(){for(b=n;d&&i(s,n+1,f,1););for(A=0;Y+4>A;A++)for(v=0;T>v;v++)u=A*T+v,A>=Y&&(N[u]=t(v,A-Y,0,R[0])?R[0]:0),O[u]=t(v-s,A-b,f)?d:t(v-s,A-n,f)?d+8:N[u]||0,(C=y[L]("tis-"+u))&&(C.style.background="#"+(1==$&&2>p%4&&c[A]?"fff":E[O[u]%8]),C.style.opacity=O[u]>7?.2:1);n=b,b='<div style="text-align:right;font-size:150%">',y[L]("tis-status").innerHTML="Score"+b+J+"</div>Lines"+b+j+"</div>Level"+b+D+"</div>"}function i(i,o,a,r){for(S=0;v=3&S,A=S>>2,16>S;S++)if(t(v,A,a)&&((v+=i)<0||v>=T||(A+=o)<0||A>=Y||N[A*T+v]))return 0;return s=i,n=o,f=a,H=0,r||e(),1}function o(t){switch(x=(t-l)/1e3||0,x>.1&&(x=.1),l=t,$){case 2:if(p-->4&&!(p%4)){for(v=0;T>v;v++)N[p*T/4+v]=1+Math.floor(7*Math.random());e()}break;case 1:if(--p<0){for(A in c)for(u=A*T+T-1;u>=0;u--)N[u]=N[u-T];$=0}e();break;case 0:w=1;for(g in U){switch(parseInt(g)){case 37:if(U[g]<0)break;U[g]-=G,i(s-1,n,f);break;case 39:if(U[g]<0)break;U[g]-=G,i(s+1,n,f);break;case 38:if(U[g])break;for(;i(s,n+1,f););H=9;break;case 90:case 186:w=-1;case 88:case 81:if(!U[g])for(u=0;5>u&&(b=(1==d?I:K).charCodeAt((f+4+(w-1)/2)%4*5+u)-32,!i(s+w*((7&b)-2),n+w*(2-(b>>3)),(f+4+w)%4));u++);}U[g]+=x}if(h+=Math.max(U[40]?.2:0,x*(D+1)/1.5),h>1&&(h=0,i(s,n+1,f)),!d||H>1){e();for(u in N)N[u]=O[u];for(g=0,c=[],A=0;Y>A;A++){for(b=1,v=0;T>v;v++)if(!N[A*T+v]){b=0;break}b&&(c[A]=1,g++,$=1,p=6)}if(J+=[0,100,300,500,800][g]*D,j+=g,D=1+Math.floor(j/10),R.length<2)for(b=1;255!=b;){for(S=0;b&1<<S;S=Math.ceil(7*Math.random()));b|=1<<S,R.push(S)}d=R.shift(),h=0,i(3,0,0)||($=2,p=4*Y),e()}H+=x}window.requestAnimationFrame(o)}function a(t){b=t.keyCode,77==b&&(b=y[L]("tis-music"),b.paused?b.play():b.pause()),U[b]||(U[b]=0),(b>36&&41>b||88==b||88==b||90==b||186==b)&&t.preventDefault()}function r(t){delete U[t.keyCode]}var d,s,n,f,p,c,h,x,l,u,S,v,A,b,g,C,w,y=document,L="getElementById",k="addEventListener",m=["`+,^,+Y),`.,C,^`\\Yq^.1e31H,01.,C,^`\\Yq","T$$T,+)$),Y))<$TTYTl.).1^..D,\\.,<$TTTTT`","GNKNGNKNLSOSLSOSKSNSKSNSLSNSL@BCESOSESOSCOCOCOCOBNBN?J?J@CGL@@@@"],M=["xtvstqpsxtvs\\`}|x","tqspqqpptqspY`xx","LSOSLSOSKSNSKSNSLSOSLSOSKSNSKSNS"],N=[],O=[],T=10,Y=22,B=T*Y+20,E="080808 0dd 36f e80 dd0 0e0 c0c f22".split(" "),q=atob("8ABERAAPIiJxACYCcAQiA3QAIgZwASMCZgBmAGYAZgA2AGIEYAMxAnIAYgJwAjICYwBkAjAGMgE"),I="203(C214A,241<!230#8",K='219"!23+BC23;"#21)BA',G=.15,$=0,J=0,j=0,D=1,H=0,R=[],U=[],Z='<div id="tis-root" style="position:fixed;width:280px;height:400px;left:50%;top:50%;margin:-240px -160px;background:rgba(0,0,0,0.8);box-shadow:0 0 30px #000;border-radius:30px;padding:40px"><div id="tis-grid" style="background:#000;width:200px;height:400px;box-shadow:0 0 9px #222;">';for(g='" style="width:20px;height:20px;float:left;box-shadow:-2px -2px 8px rgba(0,0,0,0.4) inset, 0 0 2px #000 inset;"></div>',u=0;B>u;u++)N.push(0),u>19&&220>u&&(Z+='<div id="tis-'+u+g);for(Z+='</div><div style="position:absolute;right:20px;top:40px;width:80px;color:#eee;font:normal 15px sans-serif"><div id="tis-status"></div>Next<div style="margin:8px 0;height:40px;box-shadow:0 0 9px #000;">',u=220;B>u;u++)4>u%T&&(Z+='<div id="tis-'+u+g);Z+="</div></div></div>",g=881856,b=new Uint8Array(g+44),b.set([82,73,70,70,g+36&255,g+36>>8&255,g+36>>16,0,87,65,86,69,102,109,116,32,16,0,0,0,1,0,1,0,34,86,0,0,34,86,0,0,1,0,8,0,100,97,116,97,255&g,g>>8&255,g>>16,0]),M[2]+=M[2];for(x in m)for(m[x]+=m[x]+M[x],u=44,S=0;S<m[x].length;S++)for(C=m[x].charCodeAt(S)-(2==x?64:32),v=2*Math.PI*(2==x?55:261.63)*Math.pow(2,C%24/12)/22050,g=[.2,.1,.1][x],A=0;A<4593*[1,3,2,4][Math.floor(C/24)];A++)b[u++]+=127*(!x+g*(Math.sin(A*v)>0?1:-1)),g*=.9999;Z+='<audio id="tis-music" src="'+URL.createObjectURL(new Blob([b],{type:"audio/wav"}))+'" loop'+("#m"==location.hash?"":" autoplay")+"></audio>",b=y.createElement("div"),b.innerHTML=Z,y.body.appendChild(b),o(0),y[k]("keydown",a),y[k]("keyup",r)});