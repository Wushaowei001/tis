!function(){var t,e,i,o,a,r,d,s,n,f,p,h,c,x,l,u=document,S="getElementById",b="addEventListener",v=["`+,^,+Y),`.,C,^`\\Yq^.1e31H,01.,C,^`\\Yq","T$$T,+)$),Y))<$TTYTl.).1^..D,\\.,<$TTTTT`"],g="GNKNGNKNLSOSLSOSKSNSKSNSLSNSL@BCESOSESOSCOCOCOCOBNBN?J?J@CGL@@@@",y="LSOSLSOSKSNSKSNSLSOSLSOSKSNSKSNS",k=[],w=[],L=10,C=22,M=L*C+20,m="#080808 #0dd #36f #e80 #dd0 #0e0 #c0c #f22 #002c2c #0a1433 #301b00 #2c2c00 #003000 #290029 #330707".split(" "),N=[,[240,17476,3840,8738],[113,550,1136,802],[116,1570,368,547],[102,102,102,102],[54,1122,864,561],[114,610,624,562],[99,612,1584,306]],O=.15,T=0,q=0,K=0,Y=1,B=0,E=[],$=[],A='<div id="tis-root" style="position:fixed;width:280px;height:400px;left:50%;top:50%;margin:-240px -160px;background:rgba(0,0,0,0.8);box-shadow:0 0 30px #000;border-radius:30px;padding:40px"><div id="tis-grid" style="background:#000;width:200px;height:400px;box-shadow:0 0 9px #222;">';u[b]("DOMContentLoaded",function(){function I(e,i,o,a){return t&&(3&e)==e&&(3&i)==i&&N[a||t][o]&1<<4*i+e}function G(){for(c=i;t&&!H(e,c+1,o);c++);for(h=0;C+4>h;h++)for(p=0;L>p;p++)n=h*L+p,h>=C&&(k[n]=I(p,h-C,0,E[0])?E[0]:0),w[n]=I(p-e,h-i,o)?t:I(p-e,h-c,o)?t+7:k[n]||0,(l=u[S]("tis-"+n))&&(l.style.background=m[w[n]]);c='<div style="text-align:right;font-size:150%">',u[S]("tis-status").innerHTML="Score"+c+q+"</div>Lines"+c+K+"</div>Level"+c+Y+"</div>"}function H(t,e,i){for(h=e;e+4>h;h++)for(p=t;t+4>p;p++)if(I(p-t,h-e,i)&&(0>p||p>=L||0>h||h>=C||k[h*L+p]))return 1;return 0}function U(l){switch(d=(l-s)/1e3||0,s=l,T){case 1:if(a>1){for(p=0;L>p;p++)k[a*L+p]=1+Math.floor(7*Math.random());G(),a--}break;case 0:for(x in $){switch(parseInt(x)){case 37:if($[x]<0)break;$[x]-=O,H(e-1,i,o)||(e--,B=0,G());break;case 39:if($[x]<0)break;$[x]-=O,H(e+1,i,o)||(e++,B=0,G());break;case 38:if($[x])break;for(;!H(e,i+1,o);)i++;B=9;break;case 90:case 186:$[x]||H(e,i,(o+3)%4)||(o=(o+3)%4,B=0,G());break;case 88:case 81:$[x]||H(e,i,(o+1)%4)||(o=(o+1)%4,B=0,G())}$[x]+=d}if(r+=Math.max($[40]?.2:0,d*(Y+1)/1.5),r>1&&(r=0,H(e,i+1,o)||(i++,B=0,G())),!t||B>1&&H(e,i+1,o)){for(G(),n=0;M>n;n++)k[n]=w[n];for(x=0,h=0;C>h;h++){for(c=1,p=0;L>p;p++)if(!k[h*L+p]){c=0;break}if(c)for(x++,n=h*L+L-1;n>=0;n--)k[n]=k[n-L]}if(q+=[0,100,300,500,800][x]*Y,K+=x,Y=1+Math.floor(K/10),E.length<2)for(c=1,n=0;7>n;n++){for(f=0;c&1<<f;)f=Math.ceil(7*Math.random());c|=1<<f,E.push(f)}t=E.shift(),e=3,i=0,o=0,r=0,B=0,H(e,i,o)&&(T=1,a=C),G()}B+=d}window.requestAnimationFrame(U)}function D(t){77==t.keyCode&&(c=u[S]("tis-music"),c.paused?c.play():c.pause()),$[t.keyCode]||($[t.keyCode]=0)}function J(t){delete $[t.keyCode]}for(v[0]=v[0]+v[0]+"xtvstqpsxtvs\\`}|x",v[1]=v[1]+v[1]+"tqspqqpptqspY`xx",g=g+g+y+y,x='" style="width:20px;height:20px;float:left;box-shadow:-2px -2px 8px rgba(0,0,0,0.4) inset, 0 0 2px #000 inset;"></div>',n=0;M>n;n++)k.push(0),n>19&&220>n&&(A+='<div id="tis-'+n+x);for(A+='</div><div style="position:absolute;right:20px;top:40px;width:80px;color:#eee;font:normal 15px sans-serif"><div id="tis-status"></div>Next<div style="margin:8px 0;height:40px;box-shadow:0 0 9px #000;">',n=220;M>n;n++)4>n%L&&(A+='<div id="tis-'+n+x);for(A+="</div></div></div>",x=881856,c=new Uint8Array(x+44),c.set([82,73,70,70,x+36&255,x+36>>8&255,x+36>>16,0,87,65,86,69,102,109,116,32,16,0,0,0,1,0,1,0,34,86,0,0,34,86,0,0,1,0,8,0,100,97,116,97,255&x,x>>8&255,x>>16,0]),d=0;2>d;d++)for(n=44,f=0;f<v[d].length;f++)for(l=v[d].charCodeAt(f)-32,p=2*Math.PI*261.63*Math.pow(2,l%24/12)/22050,x=.2-.1*d,h=0;h<4593*[1,3,2,4][Math.floor(l/24)];h++)c[n++]+=127*(1-d+x*(Math.sin(h*p)>0?1:-1)),x*=.9999;for(n=44,f=0;f<g.length;f++)for(l=g.charCodeAt(f)-64,p=2*Math.PI*55*Math.pow(2,l/12)/22050,x=.1,h=0;4593>h;h++)c[n++]+=127*x*(Math.sin(h*p)>0?1:-1),x*=.9999;A+='<audio id="tis-music" src="'+URL.createObjectURL(new Blob([c],{type:"audio/wav"}))+'" loop'+("#m"==location.hash?"":" autoplay")+"></audio>",c=u.createElement("div"),c.innerHTML=A,u.body.appendChild(c),U(0),u[b]("keydown",D),u[b]("keyup",J)})}();