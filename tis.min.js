!function(){var e=document,i="addEventListener",t="charCodeAt",o="keyCode",r="&&((%'%'BA",n=0;e[i]("keydown",function(a){n=a[o]==r[t](n)?n+1:0,n>9&&!function(){function r(e,i,o,r){return p&&!(-4&e)&&!(-4&i)&&$[t](8*(r||p)-8+2*o+(i>>1))&1<<4*(1&i)+e}function n(){for(k=x;p&&a(c,x+1,h,1););for(y=0;M+4>y;y++)for(A=0;I>A;A++)g=y*I+A,y>=M&&(q[g]=r(A,y-M,0,D[0])?D[0]:0),K[g]=r(A-c,y-k,h)?p:r(A-c,y-x,h)?p+8:q[g]||0,(C=e[O]("tis-"+g))&&(C=C.style,C.background="#"+(1==H&&2>u%4&&l[y]?"fff":J[K[g]%8]),C.opacity=K[g]>7?.2:1);x=k,k='<div style="text-align:right;font-size:150%">',e[O]("tis-status").innerHTML="Score"+k+R+"</div>Lines"+k+U+"</div>Level"+k+z+"</div>"}function a(e,i,t,o){for(w=0;A=3&w,y=w>>2,16>w;w++)if(r(A,y,t)&&((A+=e)<0||A>=I||(y+=i)<0||y>=M||q[y*I+A]))return 0;return c=e,x=i,h=t,Q=0,o||n(),1}function s(i){switch(v=(i-b)/1e3||0,v>.1&&(v=.1),b=i,H){case 2:if(u-->4&&!(u%4)){for(A=0;I>A;A++)q[u*I/4+A]=1+~~(7*B.random());n()}break;case 1:if(--u<0){for(y in l)for(g=y*I+I-1;g>=0;g--)q[g]=q[g-I];H=0}n();break;case 0:L=1;for(m in F){switch(parseInt(m)){case 27:return e.body.removeChild(P),e[T]("keydown",d),e[T]("keyup",f),void Y.pause();case 37:if(F[m]<0)break;F[m]-=.15,a(c-1,x,h);break;case 39:if(F[m]<0)break;F[m]-=.15,a(c+1,x,h);break;case 38:if(F[m])break;for(;a(c,x+1,h););Q=9;break;case 90:case 186:L=-1;case 88:case 81:if(!F[m])for(g=0;5>g&&(k=(1==p?Z:j)[t]((h+4+(L-1)/2)%4*5+g)-32,!a(c+L*((7&k)-2),x+L*(2-(k>>3)),(h+4+L)%4));g++);}F[m]+=v}if(S+=B.max(F[40]?.2:0,v*B.pow(1.23,z)),S>1&&(S=0,a(c,x+1,h)),!p||Q>1){n();for(g in q)q[g]=K[g];for(m=0,l=[],y=0;M>y;y++){for(k=1,A=0;I>A;A++)if(!q[y*I+A]){k=0;break}k&&(l[y]=1,m++,H=1,u=6)}if(R+=[0,100,300,500,800][m]*z,U+=m,z=1+~~(U/10),D.length<2)for(k=1;255!=k;){for(w=0;k&1<<w;w=B.ceil(7*B.random()));k|=1<<w,D.push(w)}p=D.shift(),S=0,a(3,0,0)||(H=2,u=4*M),n()}Q+=v}window.requestAnimationFrame(s)}function d(e){k=e[o],77==k&&(Y.paused?Y.play():Y.pause()),F[k]||(F[k]=0),(k>36&&41>k||81==k||88==k||90==k||186==k)&&e.preventDefault()}function f(e){delete F[e[o]]}var p,c,x,h,u,l,v,S,b,g,w,A,y,k,m,C,L,N="createElement",O="getElementById",T="removeEventListener",B=Math,Y=["`+,^,+Y),`.,C,^`\\Yq^.1e31H,01.,C,^`\\Yq","T$$T,+)$),Y))<$TTYTl.).1^..D,\\.,<$TTTTT`","GNKNGNKNLSOSLSOSKSNSKSNSLSNSL@BCESOSESOSCOCOCOCOBNBN?J?J@CGL@@@@"],E=["xtvstqpsxtvs\\`}|x","tqspqqpptqspY`xx","LSOSLSOSKSNSKSNSLSOSLSOSKSNSKSNS"],q=[],K=[],I=10,M=22,G=I*M+20,J="080808 0dd 36f e80 dd0 0e0 c0c f22".split(" "),$=atob("8ABERAAPIiJxACYCcAQiA3QAIgZwASMCZgBmAGYAZgA2AGIEYAMxAnIAYgJwAjICYwBkAjAGMgE"),Z="203(C214A,241<!230#8",j='219"!23+BC23;"#21)BA',D=[],H=0,R=0,U=0,z=1,Q=0,F=[],P='<div style="position:fixed;width:360px;left:50%;top:50%;margin:-270px -180px;background:rgba(0,0,0,0.8);box-shadow:0 0 30px #000;border-radius:30px"><div style="margin:20px 40px;font-size:80%;color:#888"><b><a href="http://github.com/ttencate/tis" style="color:inherit">Tis</a></b>: 4 kB of JavaScript<br><br>Left/right: move | Z/X: rotate<br>Down/up: soft/hard drop | M: music | Esc: quit</div><div style="float:right;margin:0 20px;width:80px;color:#eee;font:15px sans-serif"><div id="tis-status"></div>Next<div style="margin:8px 0;height:40px;box-shadow:0 0 9px #000;">';for(m='" style="width:20px;height:20px;float:left;box-shadow:-2px -2px 8px rgba(0,0,0,0.4) inset, 0 0 2px #000 inset;"></div>',g=220;G>g;g++)4>g%I&&(P+='<div id="tis-'+g+m);for(P+='</div></div><div style="background:#000;width:200px;height:400px;box-shadow:0 0 9px #222;margin:0 40px 40px">',g=0;G>g;g++)q.push(0),g>19&&220>g&&(P+='<div id="tis-'+g+m);P+="</div></div>",k=e[N]("div"),k.innerHTML=P,e.body.appendChild(P=k),m=881856,k=new Uint8Array(m+44),k.set([82,73,70,70,m+36&255,m+36>>8&255,m+36>>16,0,87,65,86,69,102,109,116,32,16,0,0,0,1,0,1,0,34,86,0,0,34,86,0,0,1,0,8,0,100,97,116,97,255&m,m>>8&255,m>>16,0]),E[2]+=E[2];for(v in Y)for(Y[v]+=Y[v]+E[v],g=44,w=0;w<Y[v].length;w++)for(C=Y[v][t](w)-(2==v?64:32),A=.00499*B.pow(2,(C%24+(2==v?0:27))/12),m=[15,9,9][v],y=0;y<4593*[1,3,2,4][~~(C/24)];y++)k[g++]=(k[g]||127)+(1>y*A%2?m:-m),m*=.9999;Y=new Audio(URL.createObjectURL(new Blob([k],{type:"audio/wav"}))),Y.loop=1,"#m"!=location.hash&&Y.play(),s(0),e[i]("keydown",d),e[i]("keyup",f)}()})}();