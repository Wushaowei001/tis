!function(){var t=document,e="addEventListener",i="charCodeAt",o="keyCode",r="keydown",n=0;t[e](r,function(f){n=f[o]=="&&((%'%'BA"[i](n)?n+1:0,n>9&&!function(){function n(t,e,o,r){return x&&!(-4&t)&&!(-4&e)&&D[i](8*(r||x)-8+2*o+(e>>1))&1<<4*(1&e)+t}function f(){for(m=S;x&&p(u,S+1,c,1););for(L=0;J+4>L;L++)for(w=0;I>w;w++)b=L*I+w,L>=J&&(M[b]=n(w,L-J,0,U[0])?U[0]:0),G[b]=n(w-u,L-m,c)?x:n(w-u,L-S,c)?x+8:M[b]||0,(y=T["tis-"+b])&&(y=y.style,y.background="#"+(1==Z&&2>h%4&&l[L]?"fff":j[G[b]%8]),y.opacity=G[b]>7?.2:1);S=m,m=W+'0;text-align:right;font-size:150%">',T["tis-status"].innerHTML="Score"+m+z+X+"Lines"+m+Q+X+"Level"+m+F+X}function p(t,e,i,o){for(v=0;w=3&v,L=v>>2,16>v;v++)if(n(w,L,i)&&((w+=t)<0||w>=I||(L+=e)<0||L>=J||M[L*I+w]))return;return u=t,S=e,c=i,P=0,o||f(),1}function a(e){if(A=(e-C)/1e3||0,A>.1&&(A=.1),C=e,2==Z){if(h-->4&&!(h%4)){for(w=0;I>w;w++)M[h*I/4+w]=1+~~(7*E.random());f()}}else if(1==Z){if(--h<0){for(L in l)for(b=L*I+I-1;b>=0;b--)M[b]=M[b-I];Z=0}f()}else{for(N in V){if(27==N)return t.body.removeChild(te),t[Y](r,s),t[Y](q,d),void k.pause();if((37==N||39==N)&&(O=1-2*(37==N),V[N]>=0&&(V[N]-=V[N]?.05:.15,p(u+O,S,c))),38==N&&!V[N]){for(;p(u,S+1,c););P=9}if((16==N||17==N)&&(O=1-2*(17==N),!V[N]))for(b=0;5>b&&(m=(1==x?H:R)[i]((c+4+(O-1)/2)%4*5+b)-32,!p(u+O*((7&m)-2),S+O*(2-(m>>3)),(c+4+O)%4));b++);V[N]+=A}if(g+=E.max(V[40]?.2:0,A*E.pow(1.23,F)),g>1&&(g=0,p(u,S+1,c)),!x||P>1){for(b in M)M[b]=G[b];N=0,l=[];t:for(L=0;J>L;L++){for(w=0;I>w;w++)if(!M[L*I+w])continue t;l[L]=1,N++,Z=1,h=6}if(z+=100*[0,1,3,5,8][N]*F,Q+=N,F=1+~~(Q/10),U.length<2)for(m=1;255!=m;){for(v=0;m&1<<v;v=E.ceil(7*E.random()));m|=1<<v,U.push(v)}x=U.shift(),g=0,p(3,0,0)||(x=0,Z=2,h=4*J)}P+=A}requestAnimationFrame(a)}function s(t){m=t[o],77==m&&(k.paused?k.play():k.pause()),V[m]||(V[m]=0),(m>36&&41>m||81==m||88==m||90==m||186==m)&&t.preventDefault()}function d(t){delete V[t[o]]}var x,u,S,c,h,l,A,g,C,b,v,w,L,m,N,y,O,T=window,B="createElement",Y="removeEventListener",q="keyup",E=Math,k=["`+,^,+Y),`.,C,^`\\Yq^.1e31H,01.,C,^`\\Yq","T$$T,+)$),Y))<$TTYTl.).1^..D,\\.,<$TTTTT`","GNKNGNKNLSOSLSOSKSNSKSNSLSNSL@BCESOSESOSCOCOCOCOBNBN?J?J@CGL@@@@"],K=["xtvstqpsxtvs\\`}|x","tqspqqpptqspY`xx","LSOSLSOSKSNSKSNSLSOSLSOSKSNSKSNS"],M=[],G=[],I=10,J=22,$=I*J+20,j="080808 0dd 36f e80 dd0 0e0 c0c f22".split(" "),D=atob("8ABERAAPIiJxACYCcAQiA3QAIgZwASMCZgBmAGYAZgA2AGIEYAMxAnIAYgJwAjICYwBkAjAGMgE"),H="203(C214A,241<!230#8",R='219"!23+BC23;"#21)BA',U=[],Z=0,z=0,Q=0,F=1,P=0,V=[],W='<div style="margin:',X="</div>",_=";box-shadow:",te=W+"-270px -180px;position:fixed;width:360px;left:50%;top:50%;font:13px sans-serif;background:rgba(0,0,0,.8)"+_+'0 0 30px #000;border-radius:30px">'+W+'20px 40px;color:#888"><b><a href="http://github.com/ttencate/tis" style="color:inherit">Tis</a></b>: 4 kB of JavaScript<br><br>Left/right: move | Shift/Ctrl: rotate<br>Down/up: soft/hard drop | M: music | Esc: quit'+X+W+'0 20px;float:right;width:80px;color:#eee;font-size:15px"><div id="tis-status">'+X+"Next"+W+"8px 0;height:40px"+_+'0 0 9px #000">';for(N=W+"0;width:20px;height:20px;float:left"+_+'-2px -2px 8px rgba(0,0,0,.4) inset,0 0 2px #000 inset" id="tis-',b=220;$>b;b++)4>b%I&&(te+=N+b+'">'+X);for(te+=X+X+W+"0 40px 40px;background:#000;width:200px;height:400px"+_+'0 0 9px #222">',b=0;$>b;b++)M.push(0),b>19&&220>b&&(te+=N+b+'">'+X);te+=X+X,m=t[B]("div"),m.innerHTML=te,t.body.appendChild(te=m),N=881856,m=new Uint8Array(N+44),m.set([82,73,70,70,N+36&255,N+36>>8&255,N+36>>16,0,87,65,86,69,102,109,116,32,16,0,0,0,1,0,1,0,34,86,0,0,34,86,0,0,1,0,8,0,100,97,116,97,255&N,N>>8&255,N>>16,0]),K[2]+=K[2];for(A in k)for(k[A]+=k[A]+K[A],b=44,v=0;v<k[A].length;v++)for(y=k[A][i](v)-(2==A?64:32),w=.00499*E.pow(2,(y%24+(2==A?0:27))/12),N=[15,9,9][A],L=0;L<4593*[1,3,2,4][~~(y/24)];L++)m[b++]=(m[b]||127)+(1>L*w%2?N:-N),N*=.9999;k=new Audio(URL.createObjectURL(new Blob([m],{type:"audio/wav"}))),k.loop=1,"#m"!=location.hash&&k.play(),a(0),t[e](r,s),t[e](q,d)}()})}();