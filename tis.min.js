!function(){var e=document,i="addEventListener",t="charCodeAt",o="keyCode",r="&&((%'%'BA",a=0;e[i]("keydown",function(n){a=n[o]==r[t](a)?a+1:0,a>9&&!function(){function r(e,i,o,r){return d&&!(-4&e)&&!(-4&i)&&M[t](8*(r||d)-8+2*o+(i>>1))&1<<4*(1&i)+e}function a(){for(w=p;d&&n(f,p+1,c,1););for(A=0;E+4>A;A++)for(g=0;q>g;g++)v=A*q+g,A>=E&&(B[v]=r(g,A-E,0,$[0])?$[0]:0),Y[v]=r(g-f,A-w,c)?d:r(g-f,A-p,c)?d+8:B[v]||0,(k=e[L]("tis-"+v))&&(k=k.style,k.background="#"+(1==U&&2>x%4&&h[A]?"fff":I[Y[v]%8]),k.opacity=Y[v]>7?.2:1);p=w,w='<div style="text-align:right;font-size:150%">',e[L]("tis-status").innerHTML="Score"+w+Z+"</div>Lines"+w+j+"</div>Level"+w+D+"</div>"}function n(e,i,t,o){for(b=0;g=3&b,A=b>>2,16>b;b++)if(r(g,A,t)&&((g+=e)<0||g>=q||(A+=i)<0||A>=E||B[A*q+g]))return 0;return f=e,p=i,c=t,H=0,o||a(),1}function s(e){switch(l=(e-u)/1e3||0,l>.1&&(l=.1),u=e,U){case 2:if(x-->4&&!(x%4)){for(g=0;q>g;g++)B[x*q/4+g]=1+~~(7*N.random());a()}break;case 1:if(--x<0){for(A in h)for(v=A*q+q-1;v>=0;v--)B[v]=B[v-q];U=0}a();break;case 0:m=1;for(y in R){switch(parseInt(y)){case 37:if(R[y]<0)break;R[y]-=.15,n(f-1,p,c);break;case 39:if(R[y]<0)break;R[y]-=.15,n(f+1,p,c);break;case 38:if(R[y])break;for(;n(f,p+1,c););H=9;break;case 90:case 186:m=-1;case 88:case 81:if(!R[y])for(v=0;5>v&&(w=(1==d?G:J)[t]((c+4+(m-1)/2)%4*5+v)-32,!n(f+m*((7&w)-2),p+m*(2-(w>>3)),(c+4+m)%4));v++);}R[y]+=l}if(S+=N.max(R[40]?.2:0,l*N.pow(1.23,D)),S>1&&(S=0,n(f,p+1,c)),!d||H>1){a();for(v in B)B[v]=Y[v];for(y=0,h=[],A=0;E>A;A++){for(w=1,g=0;q>g;g++)if(!B[A*q+g]){w=0;break}w&&(h[A]=1,y++,U=1,x=6)}if(Z+=[0,100,300,500,800][y]*D,j+=y,D=1+~~(j/10),$.length<2)for(w=1;255!=w;){for(b=0;w&1<<b;b=N.ceil(7*N.random()));w|=1<<b,$.push(b)}d=$.shift(),S=0,n(3,0,0)||(U=2,x=4*E),a()}H+=l}window.requestAnimationFrame(s)}var d,f,p,c,x,h,l,S,u,v,b,g,A,w,y,k,m,C="createElement",L="getElementById",N=Math,O=["`+,^,+Y),`.,C,^`\\Yq^.1e31H,01.,C,^`\\Yq","T$$T,+)$),Y))<$TTYTl.).1^..D,\\.,<$TTTTT`","GNKNGNKNLSOSLSOSKSNSKSNSLSNSL@BCESOSESOSCOCOCOCOBNBN?J?J@CGL@@@@"],T=["xtvstqpsxtvs\\`}|x","tqspqqpptqspY`xx","LSOSLSOSKSNSKSNSLSOSLSOSKSNSKSNS"],B=[],Y=[],q=10,E=22,K=q*E+20,I="080808 0dd 36f e80 dd0 0e0 c0c f22".split(" "),M=atob("8ABERAAPIiJxACYCcAQiA3QAIgZwASMCZgBmAGYAZgA2AGIEYAMxAnIAYgJwAjICYwBkAjAGMgE"),G="203(C214A,241<!230#8",J='219"!23+BC23;"#21)BA',$=[],U=0,Z=0,j=0,D=1,H=0,R=[],z='<div style="position:fixed;width:360px;left:50%;top:50%;margin:-270px -180px;background:rgba(0,0,0,0.8);box-shadow:0 0 30px #000;border-radius:30px"><div style="margin:20px 40px;font-size:80%;color:#888"><b><a href="http://github.com/ttencate/tis" style="color:inherit">Tis</a></b>: 4 kB of JavaScript<br><br>Left/right: move | Z/X: rotate<br>Down: soft drop | Up: hard drop | M: music</div><div style="float:right;margin:0 20px;width:80px;color:#eee;font:15px sans-serif"><div id="tis-status"></div>Next<div style="margin:8px 0;height:40px;box-shadow:0 0 9px #000;">';for(y='" style="width:20px;height:20px;float:left;box-shadow:-2px -2px 8px rgba(0,0,0,0.4) inset, 0 0 2px #000 inset;"></div>',v=220;K>v;v++)4>v%q&&(z+='<div id="tis-'+v+y);for(z+='</div></div><div style="background:#000;width:200px;height:400px;box-shadow:0 0 9px #222;margin:0 40px 40px">',v=0;K>v;v++)B.push(0),v>19&&220>v&&(z+='<div id="tis-'+v+y);z+="</div></div>",w=e[C]("div"),w.innerHTML=z,e.body.appendChild(w),y=881856,w=new Uint8Array(y+44),w.set([82,73,70,70,y+36&255,y+36>>8&255,y+36>>16,0,87,65,86,69,102,109,116,32,16,0,0,0,1,0,1,0,34,86,0,0,34,86,0,0,1,0,8,0,100,97,116,97,255&y,y>>8&255,y>>16,0]),T[2]+=T[2];for(l in O)for(O[l]+=O[l]+T[l],v=44,b=0;b<O[l].length;b++)for(k=O[l][t](b)-(2==l?64:32),g=.00499*N.pow(2,(k%24+(2==l?0:27))/12),y=[15,9,9][l],A=0;A<4593*[1,3,2,4][~~(k/24)];A++)w[v++]=(w[v]||127)+(1>A*g%2?y:-y),y*=.9999;O=e[C]("audio"),O.src=URL.createObjectURL(new Blob([w],{type:"audio/wav"})),O.loop=1,"#m"!=location.hash&&O.play(),s(0),e[i]("keydown",function(e){w=e[o],77==w&&(O.paused?O.play():O.pause()),R[w]||(R[w]=0),(w>36&&41>w||88==w||88==w||90==w||186==w)&&e.preventDefault()}),e[i]("keyup",function(e){delete R[e[o]]})}()})}();