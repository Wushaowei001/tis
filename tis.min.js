!function(){var e,t,i,o,a,r,d,s,n,f,p,h,c,l,x,u=document,S="getElementById",v="addEventListener",b=["`+,^,+Y),`.,C,^`\\Yq^.1e31H,01.,C,^`\\Yq","T$$T,+)$),Y))<$TTYTl.).1^..D,\\.,<$TTTTT`"],y="GNKNGNKNLSOSLSOSKSNSKSNSLSNSL@BCESOSESOSCOCOCOCOBNBN?J?J@CGL@@@@",g="LSOSLSOSKSNSKSNSLSOSLSOSKSNSKSNS",k=[],w=[],L=10,C=22,M=L*C+20,m="#080808 #0dd #36f #e80 #dd0 #0e0 #c0c #f22 #002c2c #0a1433 #301b00 #2c2c00 #003000 #290029 #330707".split(" "),N=[,[240,17476,3840,8738],[113,550,1136,802],[116,1570,368,547],[102,102,102,102],[54,1122,864,561],[114,610,624,562],[99,612,1584,306]],O=.15,K=0,T=0,q=0,Y=1,B=0,E=[],$=[],A='<div id="tis-root" style="position:fixed;width:280px;height:400px;left:50%;top:50%;margin:-240px -160px;background:rgba(0,0,0,0.8);box-shadow:0 0 30px #000;border-radius:30px;padding:40px"><div id="tis-grid" style="background:#000;width:200px;height:400px;box-shadow:0 0 9px #222;">';u[v]("DOMContentLoaded",function(){function I(t,i,o,a){return e&&(3&t)==t&&(3&i)==i&&N[a||e][o]&1<<4*i+t}function D(){for(c=i;e&&!G(t,c+1,o);c++);for(h=0;C+4>h;h++)for(p=0;L>p;p++)n=h*L+p,h>=C&&(k[n]=I(p,h-C,0,E[0])?E[0]:0),w[n]=I(p-t,h-i,o)?e:I(p-t,h-c,o)?e+7:k[n]||0,(x=u[S]("tis-"+n))&&(x.style.background=m[w[n]]);c='<div style="text-align:right;font-size:150%">',u[S]("tis-status").innerHTML="Score"+c+T+"</div>Lines"+c+q+"</div>Level"+c+Y+"</div>"}function G(e,t,i){for(h=t;t+4>h;h++)for(p=e;e+4>p;p++)if(I(p-e,h-t,i)&&(0>p||p>=L||0>h||h>=C||k[h*L+p]))return 1;return 0}function H(x){switch(d=(x-s)/1e3||0,s=x,K){case 1:if(a>1){for(p=0;L>p;p++)k[a*L+p]=1+Math.floor(7*Math.random());D(),a--}break;case 0:for(l in $){switch(parseInt(l)){case 37:if($[l]<0)break;$[l]-=O,G(t-1,i,o)||(t--,B=0,D());break;case 39:if($[l]<0)break;$[l]-=O,G(t+1,i,o)||(t++,B=0,D());break;case 38:if($[l])break;for(;!G(t,i+1,o);)i++;B=9;break;case 90:case 186:$[l]||G(t,i,(o+3)%4)||(o=(o+3)%4,B=0,D());break;case 88:case 81:$[l]||G(t,i,(o+1)%4)||(o=(o+1)%4,B=0,D())}$[l]+=d}if(r+=Math.max($[40]?.2:0,d*(Y+1)/1.5),r>1&&(r=0,G(t,i+1,o)||(i++,B=0,D())),!e||B>1&&G(t,i+1,o)){for(D(),n=0;M>n;n++)k[n]=w[n];for(l=0,h=0;C>h;h++){for(c=1,p=0;L>p;p++)if(!k[h*L+p]){c=0;break}if(c)for(l++,n=h*L+L-1;n>=0;n--)k[n]=k[n-L]}if(T+=[0,100,300,500,800][l]*Y,q+=l,Y=1+Math.floor(q/10),E.length<2)for(c=1,n=0;7>n;n++){for(f=0;c&1<<f;)f=Math.ceil(7*Math.random());c|=1<<f,E.push(f)}e=E.shift(),t=3,i=0,o=0,r=0,B=0,G(t,i,o)&&(K=1,a=C),D()}B+=d}window.requestAnimationFrame(H)}function U(e){77==e.keyCode&&(c=u[S]("tis-music"),c.paused?c.play():c.pause()),$[e.keyCode]||($[e.keyCode]=0),e.ctrlKey||e.shiftKey||e.altKey||e.metaKey||e.preventDefault()}function J(e){delete $[e.keyCode]}for(b[0]=b[0]+b[0]+"xtvstqpsxtvs\\`}|x",b[1]=b[1]+b[1]+"tqspqqpptqspY`xx",y=y+y+g+g,l='" style="width:20px;height:20px;float:left;box-shadow:-2px -2px 8px rgba(0,0,0,0.4) inset, 0 0 2px #000 inset;"></div>',n=0;M>n;n++)k.push(0),n>19&&220>n&&(A+='<div id="tis-'+n+l);for(A+='</div><div style="position:absolute;right:20px;top:40px;width:80px;color:#eee;font:normal 15px sans-serif"><div id="tis-status"></div>Next<div style="margin:8px 0;height:40px;box-shadow:0 0 9px #000;">',n=220;M>n;n++)4>n%L&&(A+='<div id="tis-'+n+l);for(A+="</div></div></div>",l=881856,c=new Uint8Array(l+44),c.set([82,73,70,70,l+36&255,l+36>>8&255,l+36>>16,0,87,65,86,69,102,109,116,32,16,0,0,0,1,0,1,0,34,86,0,0,34,86,0,0,1,0,8,0,100,97,116,97,255&l,l>>8&255,l>>16,0]),d=0;2>d;d++)for(n=44,f=0;f<b[d].length;f++)for(x=b[d].charCodeAt(f)-32,p=2*Math.PI*261.63*Math.pow(2,x%24/12)/22050,l=.2-.1*d,h=0;h<4593*[1,3,2,4][Math.floor(x/24)];h++)c[n++]+=127*(1-d+l*(Math.sin(h*p)>0?1:-1)),l*=.9999;for(n=44,f=0;f<y.length;f++)for(x=y.charCodeAt(f)-64,p=2*Math.PI*55*Math.pow(2,x/12)/22050,l=.1,h=0;4593>h;h++)c[n++]+=127*l*(Math.sin(h*p)>0?1:-1),l*=.9999;A+='<audio id="tis-music" src="'+URL.createObjectURL(new Blob([c],{type:"audio/wav"}))+'" loop'+("#m"==location.hash?"":" autoplay")+"></audio>",c=u.createElement("div"),c.innerHTML=A,u.body.appendChild(c),H(0),u[v]("keydown",U),u[v]("keyup",J)})}();