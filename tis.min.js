!function(){var i=document,t="addEventListener",e="charCodeAt",o="keyCode",r="keydown",n=0;i[t](r,function(d){n=d[o]=="&&((%'%'BA"[e](n)?n+1:0,n>9&&!function(){function n(i,t,o,r){return x&&!(-4&i)&&!(-4&t)&&j[e](8*(r||x)-8+2*o+(t>>1))&1<<4*(1&t)+i}function d(){for(C=u;x&&f(l,u+1,v,1););for(y=0;J+4>y;y++)for(m=0;I>m;m++)b=y*I+m,y>=J&&(M[b]=n(m,y-J,0,R[0])?R[0]:0),G[b]=n(m-l,y-C,v)?x:n(m-l,y-u,v)?x+8:M[b]||0,(N=i[B]("tis-"+b))&&(N=N.style,N.background="#"+(1==U&&2>h%4&&S[y]?"fff":Z[G[b]%8]),N.opacity=G[b]>7?.2:1);u=C,C='<div style="text-align:right;font-size:150%">',i[B]("tis-status").innerHTML="Score"+C+z+"</div>Lines"+C+Q+"</div>Level"+C+F+"</div>"}function f(i,t,e,o){for(w=0;m=3&w,y=w>>2,16>w;w++)if(n(m,y,e)&&((m+=i)<0||m>=I||(y+=t)<0||y>=J||M[y*I+m]))return 0;return l=i,u=t,v=e,P=0,o||d(),1}function a(t){if(c=(t-A)/1e3||0,c>.1&&(c=.1),A=t,2==U){if(h-->4&&!(h%4)){for(m=0;I>m;m++)M[h*I/4+m]=1+~~(7*E.random());d()}}else if(1==U){if(--h<0){for(y in S)for(b=y*I+I-1;b>=0;b--)M[b]=M[b-I];U=0}d()}else{for(L in X){if(27==L)return i.body.removeChild(V),i[Y](r,s),i[Y](k,p),void q.pause();if(37==L&&X[L]>=0&&(X[L]-=.15,f(l-1,u,v)),39==L&&X[L]>=0&&(X[L]-=.15,f(l+1,u,v)),38==L){if(X[L])break;for(;f(l,u+1,v););P=9}if(((O=90==L||186==L)||88==L||81==L)&&(O=1-2*O,!X[L]))for(b=0;5>b&&(C=(1==x?D:H)[e]((v+4+(O-1)/2)%4*5+b)-32,!f(l+O*((7&C)-2),u+O*(2-(C>>3)),(v+4+O)%4));b++);X[L]+=c}if(g+=E.max(X[40]?.2:0,c*E.pow(1.23,F)),g>1&&(g=0,f(l,u+1,v)),!x||P>1){d();for(b in M)M[b]=G[b];for(L=0,S=[],y=0;J>y;y++){for(C=1,m=0;I>m;m++)if(!M[y*I+m]){C=0;break}C&&(S[y]=1,L++,U=1,h=6)}if(z+=100*[0,1,3,5,8][L]*F,Q+=L,F=1+~~(Q/10),R.length<2)for(C=1;255!=C;){for(w=0;C&1<<w;w=E.ceil(7*E.random()));C|=1<<w,R.push(w)}x=R.shift(),g=0,f(3,0,0)||(U=2,h=4*J),d()}P+=c}window.requestAnimationFrame(a)}function s(i){C=i[o],77==C&&(q.paused?q.play():q.pause()),X[C]||(X[C]=0),(C>36&&41>C||81==C||88==C||90==C||186==C)&&i.preventDefault()}function p(i){delete X[i[o]]}var x,l,u,v,h,S,c,g,A,b,w,m,y,C,L,N,O,T="createElement",B="getElementById",Y="removeEventListener",k="keyup",E=Math,q=["`+,^,+Y),`.,C,^`\\Yq^.1e31H,01.,C,^`\\Yq","T$$T,+)$),Y))<$TTYTl.).1^..D,\\.,<$TTTTT`","GNKNGNKNLSOSLSOSKSNSKSNSLSNSL@BCESOSESOSCOCOCOCOBNBN?J?J@CGL@@@@"],K=["xtvstqpsxtvs\\`}|x","tqspqqpptqspY`xx","LSOSLSOSKSNSKSNSLSOSLSOSKSNSKSNS"],M=[],G=[],I=10,J=22,$=I*J+20,Z="080808 0dd 36f e80 dd0 0e0 c0c f22".split(" "),j=atob("8ABERAAPIiJxACYCcAQiA3QAIgZwASMCZgBmAGYAZgA2AGIEYAMxAnIAYgJwAjICYwBkAjAGMgE"),D="203(C214A,241<!230#8",H='219"!23+BC23;"#21)BA',R=[],U=0,z=0,Q=0,F=1,P=0,X=[],V='<div style="position:fixed;width:360px;left:50%;top:50%;margin:-270px -180px;background:rgba(0,0,0,0.8);box-shadow:0 0 30px #000;border-radius:30px"><div style="margin:20px 40px;font-size:80%;color:#888"><b><a href="http://github.com/ttencate/tis" style="color:inherit">Tis</a></b>: 4 kB of JavaScript<br><br>Left/right: move | Z/X: rotate<br>Down/up: soft/hard drop | M: music | Esc: quit</div><div style="float:right;margin:0 20px;width:80px;color:#eee;font:15px sans-serif"><div id="tis-status"></div>Next<div style="margin:8px 0;height:40px;box-shadow:0 0 9px #000;">';for(L='" style="width:20px;height:20px;float:left;box-shadow:-2px -2px 8px rgba(0,0,0,0.4) inset, 0 0 2px #000 inset;"></div>',b=220;$>b;b++)4>b%I&&(V+='<div id="tis-'+b+L);for(V+='</div></div><div style="background:#000;width:200px;height:400px;box-shadow:0 0 9px #222;margin:0 40px 40px">',b=0;$>b;b++)M.push(0),b>19&&220>b&&(V+='<div id="tis-'+b+L);V+="</div></div>",C=i[T]("div"),C.innerHTML=V,i.body.appendChild(V=C),L=881856,C=new Uint8Array(L+44),C.set([82,73,70,70,L+36&255,L+36>>8&255,L+36>>16,0,87,65,86,69,102,109,116,32,16,0,0,0,1,0,1,0,34,86,0,0,34,86,0,0,1,0,8,0,100,97,116,97,255&L,L>>8&255,L>>16,0]),K[2]+=K[2];for(c in q)for(q[c]+=q[c]+K[c],b=44,w=0;w<q[c].length;w++)for(N=q[c][e](w)-(2==c?64:32),m=.00499*E.pow(2,(N%24+(2==c?0:27))/12),L=[15,9,9][c],y=0;y<4593*[1,3,2,4][~~(N/24)];y++)C[b++]=(C[b]||127)+(1>y*m%2?L:-L),L*=.9999;q=new Audio(URL.createObjectURL(new Blob([C],{type:"audio/wav"}))),q.loop=1,"#m"!=location.hash&&q.play(),a(0),i[t](r,s),i[t](k,p)}()})}();