!function(){var t=document,e="addEventListener",i="charCodeAt",o="keyCode",n="keydown",r=0,f=27;t[e](n,function(p){r=p[o]=="&&((%'%'BA"[i](r)?r+1:0,27==f&&r>9&&!function(){function r(t){if(!(Y=U[t])){Y=new Uint8Array(9e3),B=50,T=t>>10;for(y in Y)y>1e3&&(T=t>>4&63),Y[y]=127+(B*=1-1e-4*(15&t))*(T/2>y/10%T?-1:1);Y=U[L]=p(Y)}Y.play()}function p(t){return Y=t.length,new Audio(URL.createObjectURL(new Blob(["RIFF",new Uint32Array([Y+36,1163280727,544501094,16,65537,22050,22050,524289,1635017060,Y]),t],{type:"audio/wav"})))}function a(t,e,o,n){return S&&!(-4&t)&&!(-4&e)&&H[i](8*(n||S)-8+2*o+(e>>1))&1<<4*(1&e)+t}function s(){for(O=h;S&&d(l,h+1,A,1););for(N=0;j+4>N;N++)for(m=0;R>m;m++)L=N*R+m,N>=j&&(J[L]=a(m,N-j,0,Q[0])?Q[0]:0),$[L]=a(m-l,N-O,A)?S:a(m-l,N-h,A)?S+8:J[L]||0,(T=k["tis-"+L])&&(T=T.style,T.background="#"+(1==P&&2>g%4&&w[N]?"fff":F[$[L]%8]),T.opacity=$[L]>7?.2:1);h=O,O=ee+'0;text-align:right;font-size:150%">',k["tis-status"].innerHTML="Score"+O+V+ie+"Lines"+O+W+ie+"Level"+O+X+ie}function d(t,e,i,o){for(y=0;m=3&y,N=y>>2,16>y;y++)if(a(m,N,i)&&((m+=t)<0||m>=R||(N+=e)<0||N>=j||J[N*R+m]))return;return l=t,h=e,A=i,_=0,o||s(),1}function x(e){if(b=(e-v)/1e3||0,b>.1&&(b=.1),v=e,2==P){if(g-->4&&!(g%4)){for(m=0;R>m;)J[g*R/4+m++]=1+~~(7*M.random());s()}}else if(1==P){if(--g<0){for(N in w)for(L=N*R+R-1;L>=0;L--)J[L]=J[L-R];P=0}s()}else{for(f in te){if(27==f)return t.body.removeChild(ne),t[E](n,u),t[E](K,c),void G.pause();if((37==f||39==f)&&te[f]>=0&&(te[f]-=te[f]?.05:.2,d(l+1-2*(37==f),h,A)),32==f&&!te[f]){for(;d(l,h+1,A););_=9}if((38==f||18==f||17==f)&&(B=1-2*(17==f),!te[f]))for(L=0;5>L;)if(O=(1==S?Z:z)[i]((A+4+(B-1)/2)%4*5+L++)-32,d(l+B*((7&O)-2),h+B*(2-(O>>3)),(A+4+B)%4)){r(8303);break}te[f]+=b}if(C+=M.max(te[40]?.2:0,b*M.pow(1.23,X)),C>1&&(C=0,d(l,h+1,A)),_>1){S&&r(31445);for(L in J)J[L]=$[L];f=0,w=[];t:for(N=0;j>N;N++){for(m=0;R>m;)if(!J[N*R+m++])continue t;w[N]=P=1,f++,g=6}if(f&&r([,8392,8260,8242,8225][f]),V+=100*[0,1,3,5,8][f]*X,W+=f,X=1+~~(W/10),Q.length<2)for(O=1;255!=O;){for(y=0;O&1<<y;y=1+~~(7*M.random()));O|=1<<y,Q.push(y)}S=Q.shift(),C=0,d(3,0,0)||(S=0,P=2,g=4*j,r(31360))}_+=b}requestAnimationFrame(x)}function u(t){O=t[o],77==O&&G[G.paused?"play":"pause"](),te[O]=te[O]||0,[17,18,27,37,38,39,40,77].indexOf(O)>=0&&t.preventDefault()}function c(t){delete te[t[o]]}var S,l,h,A,g,w,b,C,v,L,y,m,N,O,T,B,Y,k=window,q="createElement",E="removeEventListener",K="keyup",M=Math,G=["`+,^,+Y),`.,C,^`\\Yq^.1e31H,01.,C,^`\\Yq","T$$T,+)$),Y))<$TTYTl.).1^..D,\\.,<$TTTTT`","GNKNGNKNLSOSLSOSKSNSKSNSLSNSL@BCESOSESOSCOCOCOCOBNBN?J?J@CGL@@@@"],I=["xtvstqpsxtvs\\`}|x","tqspqqpptqspY`xx","LSOSLSOSKSNSKSNSLSOSLSOSKSNSKSNS"],U=[],J=[],$=[],R=10,j=22,D=R*j+20,F="08080890dd936f9e809dd090e09c0c9f22".split(9),H=atob("8ABERAAPIiJxACYCcAQiA3QAIgZwASMCZgBmAGYAZgA2AGIEYAMxAnIAYgJwAjICYwBkAjAGMgE"),Z="203(C214A,241<!230#8",z='219"!23+BC23;"#21)BA',Q=[],P=0,V=0,W=0,X=1,_=2,te=[],ee='<div style="margin:',ie="</div>",oe=";box-shadow:",ne=ee+"-270px -180px;position:fixed;width:360px;left:50%;top:50%;font:13px sans-serif;background:rgba(0,0,0,.8)"+oe+'0 0 30px #000;border-radius:30px">'+ee+'20px 40px;color:#888"><b><a href="http://github.com/ttencate/tis" style="color:inherit">Tis</a></b>: Tetris in 4 kB of JavaScript<br><br>Left/right: move | Up/Ctrl/Alt: rotate | Esc: quit<br>Down/space: soft/hard drop | M: music'+ie+ee+'0 20px;float:right;width:80px;color:#eee;font-size:15px"><div id="tis-status">'+ie+"Next"+ee+"8px 0;height:40px"+oe+'0 0 9px #000">';for(f=ee+"0;width:20px;height:20px;float:left"+oe+'-2px -2px 8px rgba(0,0,0,.4) inset,0 0 2px #000 inset" id="tis-',L=220;D>L;L++)4>L%R&&(ne+=f+L+'">'+ie);for(ne+=ie+ie+ee+"0 40px 40px;background:#000;width:200px;height:400px"+oe+'0 0 9px #222">',L=0;D>L;L++)J.push(0),L>19&&220>L&&(ne+=f+L+'">'+ie);ne+=ie+ie,O=t[q]("div"),O.innerHTML=ne,t.body.appendChild(ne=O),O=new Uint8Array(881856),I[2]+=I[2];for(b in G)for(G[b]+=G[b]+I[b],L=0,y=0;y<G[b].length;)for(T=G[b][i](y++)-(2==b?64:32),m=.00499*M.pow(2,(T%24+(2==b?0:27))/12),f=[15,9,9][b],N=0;N<4593*[1,3,2,4][~~(T/24)];)O[L++]=(O[L]||127)+(N++*m%2<1?f:-f),f*=.9999;G=p(O,1),G.play(),G.loop=1,x(0),t[e](n,u),t[e](K,c)}()})}();