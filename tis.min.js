!function(){var t=document,e="addEventListener",i="charCodeAt",o="keyCode",r="keydown",n=0,f=27;t[e](r,function(p){n=p[o]=="&&((%'%'BA"[i](n)?n+1:0,27==f&&n>9&&!function(){function n(t){return Y=t.length,Y=new Audio(URL.createObjectURL(new Blob(["RIFF",new Uint32Array([Y+36,1163280727,544501094,16,65537,22050,22050,524289,1635017060,Y]),t],{type:"audio/wav"}))),Y.play(),Y}function p(t,e,i){Y=new Uint8Array(9e3),y=50;for(L in Y)L>1e3&&(t=e),Y[L]=127+(y*=1-i)*(t/2>L%t?-1:1);n(Y,1)}function a(t,e,o,r){return c&&!(-4&t)&&!(-4&e)&&F[i](8*(r||c)-8+2*o+(e>>1))&1<<4*(1&e)+t}function s(){for(T=l;c&&d(h,l+1,A,1););for(N=0;R+4>N;N++)for(m=0;$>m;m++)L=N*$+m,N>=R&&(J[L]=a(m,N-R,0,z[0])?z[0]:0),U[L]=a(m-h,N-T,A)?c:a(m-h,N-l,A)?c+8:J[L]||0,(O=k["tis-"+L])&&(O=O.style,O.background="#"+(1==Q&&2>g%4&&w[N]?"fff":D[U[L]%8]),O.opacity=U[L]>7?.2:1);l=T,T=te+'0;text-align:right;font-size:150%">',k["tis-status"].innerHTML="Score"+T+P+ee+"Lines"+T+V+ee+"Level"+T+W+ee}function d(t,e,i,o){for(y=0;m=3&y,N=y>>2,16>y;y++)if(a(m,N,i)&&((m+=t)<0||m>=$||(N+=e)<0||N>=R||J[N*$+m]))return;return h=t,l=e,A=i,X=0,o||s(),1}function u(e){if(b=(e-v)/1e3||0,b>.1&&(b=.1),v=e,2==Q){if(g-->4&&!(g%4)){for(m=0;$>m;)J[g*$/4+m++]=1+~~(7*M.random());s()}}else if(1==Q){if(--g<0){for(N in w)for(L=N*$+$-1;L>=0;L--)J[L]=J[L-$];Q=0}s()}else{for(f in _){if(27==f)return t.body.removeChild(oe),t[E](r,x),t[E](K,S),void G.pause();if((37==f||39==f)&&_[f]>=0&&(_[f]-=_[f]?.05:.2,d(h+1-2*(37==f),l,A)),38==f&&!_[f]){for(;d(h,l+1,A););X=9}if((16==f||17==f)&&(B=1-2*(17==f),!_[f]))for(L=0;5>L;)if(T=(1==c?H:Z)[i]((A+4+(B-1)/2)%4*5+L++)-32,d(h+B*((7&T)-2),l+B*(2-(T>>3)),(A+4+B)%4)){p(80,60,.0015);break}_[f]+=b}if(C+=M.max(_[40]?.2:0,b*M.pow(1.23,W)),C>1&&(C=0,d(h,l+1,A)),!c||X>1){c&&p(300,450,5e-4);for(L in J)J[L]=U[L];f=0,w=[];t:for(N=0;R>N;N++){for(m=0;$>m;)if(!J[N*$+m++])continue t;w[N]=1,f++,Q=1,g=6}if(f&&p(80,80/f,.001/f),P+=100*[0,1,3,5,8][f]*W,V+=f,W=1+~~(V/10),z.length<2)for(T=1;255!=T;){for(y=0;T&1<<y;y=1+~~(7*M.random()));T|=1<<y,z.push(y)}c=z.shift(),C=0,d(3,0,0)||(c=0,Q=2,g=4*R,p(300,400,0))}X+=b}requestAnimationFrame(u)}function x(t){T=t[o],77==T&&(G.paused?G.play():G.pause()),_[T]||(_[T]=0),(T>36&&41>T||81==T||88==T||90==T||186==T)&&t.preventDefault()}function S(t){delete _[t[o]]}var c,h,l,A,g,w,b,C,v,L,y,m,N,T,O,B,Y,k=window,q="createElement",E="removeEventListener",K="keyup",M=Math,G=["`+,^,+Y),`.,C,^`\\Yq^.1e31H,01.,C,^`\\Yq","T$$T,+)$),Y))<$TTYTl.).1^..D,\\.,<$TTTTT`","GNKNGNKNLSOSLSOSKSNSKSNSLSNSL@BCESOSESOSCOCOCOCOBNBN?J?J@CGL@@@@"],I=["xtvstqpsxtvs\\`}|x","tqspqqpptqspY`xx","LSOSLSOSKSNSKSNSLSOSLSOSKSNSKSNS"],J=[],U=[],$=10,R=22,j=$*R+20,D="08080890dd936f9e809dd090e09c0c9f22".split(9),F=atob("8ABERAAPIiJxACYCcAQiA3QAIgZwASMCZgBmAGYAZgA2AGIEYAMxAnIAYgJwAjICYwBkAjAGMgE"),H="203(C214A,241<!230#8",Z='219"!23+BC23;"#21)BA',z=[],Q=0,P=0,V=0,W=1,X=0,_=[],te='<div style="margin:',ee="</div>",ie=";box-shadow:",oe=te+"-270px -180px;position:fixed;width:360px;left:50%;top:50%;font:13px sans-serif;background:rgba(0,0,0,.8)"+ie+'0 0 30px #000;border-radius:30px">'+te+'20px 40px;color:#888"><b><a href="http://github.com/ttencate/tis" style="color:inherit">Tis</a></b>: Tetris in 4 kB of JavaScript<br><br>Left/right: move | Shift/Ctrl: rotate<br>Down/up: soft/hard drop | M: music | Esc: quit'+ee+te+'0 20px;float:right;width:80px;color:#eee;font-size:15px"><div id="tis-status">'+ee+"Next"+te+"8px 0;height:40px"+ie+'0 0 9px #000">';for(f=te+"0;width:20px;height:20px;float:left"+ie+'-2px -2px 8px rgba(0,0,0,.4) inset,0 0 2px #000 inset" id="tis-',L=220;j>L;L++)4>L%$&&(oe+=f+L+'">'+ee);for(oe+=ee+ee+te+"0 40px 40px;background:#000;width:200px;height:400px"+ie+'0 0 9px #222">',L=0;j>L;L++)J.push(0),L>19&&220>L&&(oe+=f+L+'">'+ee);oe+=ee+ee,T=t[q]("div"),T.innerHTML=oe,t.body.appendChild(oe=T),T=new Uint8Array(881856),I[2]+=I[2];for(b in G)for(G[b]+=G[b]+I[b],L=0,y=0;y<G[b].length;)for(O=G[b][i](y++)-(2==b?64:32),m=.00499*M.pow(2,(O%24+(2==b?0:27))/12),f=[15,9,9][b],N=0;N<4593*[1,3,2,4][~~(O/24)];)T[L++]=(T[L]||127)+(N++*m%2<1?f:-f),f*=.9999;G=n(T),G.loop=1,u(0),t[e](r,x),t[e](K,S)}()})}();