document.addEventListener("DOMContentLoaded",function(){function e(e,t,i,o){return r&&!(-4&e)&&!(-4&t)&&M[k](8*(o||r)-8+2*i+(t>>1))&1<<4*(1&t)+e}function t(){for(b=n;r&&i(a,n+1,d,1););for(v=0;E+4>v;v++)for(S=0;Y>S;S++)h=v*Y+S,v>=E&&(T[h]=e(S,v-E,0,J[0])?J[0]:0),B[h]=e(S-a,v-b,d)?r:e(S-a,v-n,d)?r+8:T[h]||0,(g=w[C]("tis-"+h))&&(g=g.style,g.background="#"+(1==$&&2>s%4&&f[v]?"fff":K[B[h]%8]),g.opacity=B[h]>7?.2:1);n=b,b='<div style="text-align:right;font-size:150%">',w[C]("tis-status").innerHTML="Score"+b+D+"</div>Lines"+b+U+"</div>Level"+b+Z+"</div>"}function i(i,o,r,s){for(l=0;S=3&l,v=l>>2,16>l;l++)if(e(S,v,r)&&((S+=i)<0||S>=Y||(v+=o)<0||v>=E||T[v*Y+S]))return 0;return a=i,n=o,d=r,j=0,s||t(),1}function o(e){switch(p=(e-x)/1e3||0,p>.1&&(p=.1),x=e,$){case 2:if(s-->4&&!(s%4)){for(S=0;Y>S;S++)T[s*Y/4+S]=1+~~(7*L.random());t()}break;case 1:if(--s<0){for(v in f)for(h=v*Y+Y-1;h>=0;h--)T[h]=T[h-Y];$=0}t();break;case 0:A=1;for(u in H){switch(parseInt(u)){case 37:if(H[u]<0)break;H[u]-=.15,i(a-1,n,d);break;case 39:if(H[u]<0)break;H[u]-=.15,i(a+1,n,d);break;case 38:if(H[u])break;for(;i(a,n+1,d););j=9;break;case 90:case 186:A=-1;case 88:case 81:if(!H[u])for(h=0;5>h&&(b=(1==r?I:G)[k]((d+4+(A-1)/2)%4*5+h)-32,!i(a+A*((7&b)-2),n+A*(2-(b>>3)),(d+4+A)%4));h++);}H[u]+=p}if(c+=L.max(H[40]?.2:0,p*L.pow(1.23,Z)),c>1&&(c=0,i(a,n+1,d)),!r||j>1){t();for(h in T)T[h]=B[h];for(u=0,f=[],v=0;E>v;v++){for(b=1,S=0;Y>S;S++)if(!T[v*Y+S]){b=0;break}b&&(f[v]=1,u++,$=1,s=6)}if(D+=[0,100,300,500,800][u]*Z,U+=u,Z=1+~~(U/10),J.length<2)for(b=1;255!=b;){for(l=0;b&1<<l;l=L.ceil(7*L.random()));b|=1<<l,J.push(l)}r=J.shift(),c=0,i(3,0,0)||($=2,s=4*E),t()}j+=p}window.requestAnimationFrame(o)}var r,a,n,d,s,f,p,c,x,h,l,S,v,b,u,g,A,w=document,y="addEventListener",m="createElement",C="getElementById",L=Math,k="charCodeAt",N=["`+,^,+Y),`.,C,^`\\Yq^.1e31H,01.,C,^`\\Yq","T$$T,+)$),Y))<$TTYTl.).1^..D,\\.,<$TTTTT`","GNKNGNKNLSOSLSOSKSNSKSNSLSNSL@BCESOSESOSCOCOCOCOBNBN?J?J@CGL@@@@"],O=["xtvstqpsxtvs\\`}|x","tqspqqpptqspY`xx","LSOSLSOSKSNSKSNSLSOSLSOSKSNSKSNS"],T=[],B=[],Y=10,E=22,q=Y*E+20,K="080808 0dd 36f e80 dd0 0e0 c0c f22".split(" "),M=atob("8ABERAAPIiJxACYCcAQiA3QAIgZwASMCZgBmAGYAZgA2AGIEYAMxAnIAYgJwAjICYwBkAjAGMgE"),I="203(C214A,241<!230#8",G='219"!23+BC23;"#21)BA',J=[],$=0,D=0,U=0,Z=1,j=0,H=[],R='<div style="position:fixed;width:360px;left:50%;top:50%;margin:-270px -180px;background:rgba(0,0,0,0.8);box-shadow:0 0 30px #000;border-radius:30px"><div style="margin:20px 40px;font-size:80%;color:#888"><b><a href="http://github.com/ttencate/tis" style="color:inherit">Tis</a></b>: 4 kB of JavaScript<br><br>Left/right: move | Z/X: rotate<br>Down: soft drop | Up: hard drop | M: music</div><div style="float:right;margin:0 20px;width:80px;color:#eee;font:15px sans-serif"><div id="tis-status"></div>Next<div style="margin:8px 0;height:40px;box-shadow:0 0 9px #000;">';for(u='" style="width:20px;height:20px;float:left;box-shadow:-2px -2px 8px rgba(0,0,0,0.4) inset, 0 0 2px #000 inset;"></div>',h=220;q>h;h++)4>h%Y&&(R+='<div id="tis-'+h+u);for(R+='</div></div><div style="background:#000;width:200px;height:400px;box-shadow:0 0 9px #222;margin:0 40px 40px">',h=0;q>h;h++)T.push(0),h>19&&220>h&&(R+='<div id="tis-'+h+u);R+="</div></div>",b=w[m]("div"),b.innerHTML=R,w.body.appendChild(b),u=881856,b=new Uint8Array(u+44),b.set([82,73,70,70,u+36&255,u+36>>8&255,u+36>>16,0,87,65,86,69,102,109,116,32,16,0,0,0,1,0,1,0,34,86,0,0,34,86,0,0,1,0,8,0,100,97,116,97,255&u,u>>8&255,u>>16,0]),O[2]+=O[2];for(p in N)for(N[p]+=N[p]+O[p],h=44,l=0;l<N[p].length;l++)for(g=N[p][k](l)-(2==p?64:32),S=.0157*L.pow(2,(g%24+(2==p?0:27))/12),u=[15,9,9][p],v=0;v<4593*[1,3,2,4][~~(g/24)];v++)b[h++]=(b[h]||127)+u*(L.sin(v*S)>0?1:-1),u*=.9999;N=w[m]("audio"),N.src=URL.createObjectURL(new Blob([b],{type:"audio/wav"})),N.loop=1,"#m"!=location.hash&&N.play(),o(0),w[y]("keydown",function(e){b=e.keyCode,77==b&&(N.paused?N.play():N.pause()),H[b]||(H[b]=0),(b>36&&41>b||88==b||88==b||90==b||186==b)&&e.preventDefault()}),w[y]("keyup",function(e){delete H[e.keyCode]})});